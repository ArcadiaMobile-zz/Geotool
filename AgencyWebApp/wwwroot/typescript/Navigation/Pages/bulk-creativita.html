<style>
a.btn[disabled]{pointer-events: none;cursor: default;}
</style>

<div class="bg-top">
    <div class="bg-grad">
        <div class="container" data-fluid>
            <div class="new-title uppercase mb-20 mb-160">CARICA LE CREATIVITAÃ </div>
        </div>
    </div>
</div>

<div class="container fluid" id="form">

    <div class="row mt-50">
        <div class="col-lg-5 col-md-5 mt-120-minus">
            <div class="row">
                <div class="col-xs-12">
                    <div class="panel panel-default shadow">
                        <div class="panel-heading">
                            <span class="text-uppercase">Immagini</span>
                            <img src="assets/img/logo_cat.png" class="img-circle img-circle-admove pull-right" data-image>
                        </div>
                        <div class="panel-body mt-25">
                        
                            <!--
                            <p class="hide app">
                                Carica <b>3 banner</b> per il tuo annuncio e le immagini per le <b>landing page</b> Smartphone e Tablet.<br>
                            </p>
                            
                            <p class="hide facebook">
                                Inserisci il tuo annuncio (titolo e descrizione) e carica il <b>banner</b> per la tua inserzione.<br>
                                Carica inoltre le immagini per le <b>landing page</b> Smartphone e Tablet.
                            </p>
                            
                            <p class="hide google">
                                Inserisci il tuo annuncio (due titoli e descrizione) e le keyword della campagna.<br>
                                Carica inoltre le <b>immagini</b> per le <b>landing page</b> Smartphone e Tablet.
                            </p>

                            <p class="color-light-green-water fs-13 m-0 lh-15">
                                Le landing page utilizzate da AdMove hanno formati proprietari, assicurati di utilizzare il template a disposizione.
                            </p>

                            <div class="row">
                                <div class="col-md-12">
                                    <a href="/assets/files/GuidelinesCreative.pdf" target="_blank" class="btn btn-adm alternative text-uppercase mt-15 mr-15">Visualizza istruzioni</a>
                                    <a href="/assets/files/LandingPageAdMove.zip" target="_blank" class="btn btn-adm alternative text-uppercase mt-15">Scarica il template</a>
                                </div>
                            </div>
                            -->
                            
                            <div class="row" data-file="0">
                                <div class="col-md-12 mt-25">
                                    <p class="fs-12"><span class="text-uppercase color-orange">LANDING PAGE PER SMARTPHONE</span><span class="text-uppercase"> 640x1024 px </span><i>(max 150Kb)</i></p>
                                    <div class="box-file">
                                        <div data-maxsize="0.15" data-filetype="image/*" data-format="Format640x1024" data-width="640" data-height="1024" data-required="true" class="dropzone mb30" id="third-banner"></div>
                                        <a class="btn btn-adm flat text-uppercase my-10 pull-right clickable">Elimina</a>
                                    </div>
                                </div>
                            </div>

                            <div class="row" data-file="1">
                                <div class="col-md-12 mt-25">
                                    <p class="fs-12"><span class="text-uppercase color-orange">LANDING PAGE PER TABLET</span><span class="text-uppercase"> 2020x1320 px </span><i>(max 150Kb)</i></p>
                                    <div class="box-file">
                                        <div data-maxsize="0.15" data-filetype="image/*" data-format="Format2020x1320" data-width="2020" data-height="1320" data-required="true" class="dropzone mb30" id="fourth-banner"></div>
                                        <a class="btn btn-adm flat text-uppercase my-10 pull-right clickable">Elimina</a>
                                    </div>
                                </div>
                            </div>

                            <div class="row" data-file="2">
                                <div class="col-md-12 mt-25">
                                    <p class="fs-12"><span class="text-uppercase color-orange">FORMATO RETTANGOLO MEDIO</span><span class="text-uppercase"> 300x250 px </span><i>(max 50Kb)</i></p>
                                    <div class="box-file">
                                        <div data-maxsize="1" data-filetype="image/*" data-format="Format300x250" data-width="300" data-height="250" data-required="true" class="dropzone mb30" id="first-banner"></div>
                                        <a class="btn btn-adm flat text-uppercase my-10 pull-right clickable">Elimina</a>
                                    </div>
                                </div>
                            </div>

                            <div class="row" data-file="3">
                                <div class="col-md-12 mt-25">
                                    <p class="fs-12"><span class="text-uppercase color-orange">FORMATO INTESTITIAL</span><span class="text-uppercase"> 320x480 px </span><i>(max 80Kb)</i></p>
                                    <div class="box-file">
                                        <div data-maxsize="1" data-filetype="image/*" data-format="Format320x480" data-width="320" data-height="480" data-required="true" class="dropzone mb30"></div>
                                        <a class="btn btn-adm flat text-uppercase my-10 pull-right clickable">Elimina</a>
                                    </div>
                                </div>
                            </div>

                            <div class="row" data-file="4">
                                <div class="col-md-12 mt-25">
                                    <p class="fs-12"><span class="text-uppercase color-orange">FORMATO LEADERBOARD SMARTPHONE</span><span class="text-uppercase"> 320x50 px </span><i>(max 50Kb)</i></p>
                                    <div class="box-file">
                                        <div data-maxsize="1" data-filetype="image/*" data-format="Format320x50" data-width="320" data-height="50" data-required="true" class="dropzone mb30"></div>
                                        <a class="btn btn-adm flat text-uppercase my-10 pull-right clickable">Elimina</a>
                                    </div>
                                </div>
                            </div>

                            <div class="row" data-file="5">
                                <div class="col-md-12 mt-25">
                                    <p class="fs-12"><span class="text-uppercase color-orange">FORMATO LEADERBOARD TABLET</span><span class="text-uppercase"> 728x90 px </span><i>(max 50Kb)</i></p>
                                    <div class="box-file">
                                        <div data-maxsize="1" data-filetype="image/*" data-format="Format728x90" data-width="728" data-height="90" data-required="true" class="dropzone mb30" id="second-banner"></div>
                                        <a class="btn btn-adm flat text-uppercase my-10 pull-right clickable">Elimina</a>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6 col-lg-offset-1 col-md-7 mb-35 mt-120-minus">

            <div id="_affixPreview">
                <p class="color-sky-blue fs-17 text-uppercase text-center my-15">Anteprima grafica</p>
                <p class="fs-16 text-center mt-35" id="creativityTitle">Landing page per smartphone</p>

                <ul class="switch-preview text-center">
                    <li class="switch-smartphone"></li>
                    <li class="switch-tablet"></li>
                    <li class="switch-banner-1"></li>
                    <li class="switch-interstitial"></li>
                    <li class="switch-banner-2"></li>
                    <li class="switch-banner-3"></li>
                </ul>

                <div class="container-slider-preview">
                    <div id="slider-preview" class="owl-carousel">

                        <div class="item-preview-device">
                            <div class="smartphone">
                                <div class="mask-top"></div>
                                <div class="preview-display">
                                    <img src="" data-banner-size="Format640x1024" style="cursor: zoom-in;">
                                    <div class="approvingly" data-format="Format640x1024"><span class="fs-17 text-uppercase">In<br>approvazione</span></div>
                                </div>
                                <div class="mask-bottom"></div>
                            </div>
                        </div>

                        <div class="item-preview-device">
                            <div class="tablet">
                                <img src="" data-banner-size="Format2020x1320" style="cursor: zoom-in;">
                                <div class="approvingly" data-format="Format2020x1320"><span class="fs-17 text-uppercase">In<br>approvazione</span></div>
                            </div>
                        </div>

                        <div class="item-preview-banner">
                            <div class="preview-banner">
                                <img src="" data-banner-size="Format300x250" style="cursor: zoom-in;">
                                <div class="approvingly" data-format="Format300x250"><span class="fs-17 text-uppercase">In<br>approvazione</span></div>

                            </div>
                        </div>

                        <div class="item-preview-banner">
                            <div class="preview-banner">
                                <img src="" data-banner-size="Format320x480" style="cursor: zoom-in;">
                                <div class="approvingly" data-format="Format320x480"><span class="fs-17 text-uppercase">In approvazione</span></div>
                            </div>
                        </div>

                        <div class="item-preview-banner">
                            <div class="preview-banner">
                                <img src="" data-banner-size="Format320x50" style="cursor: zoom-in;">
                                <div class="approvingly" data-format="Format320x50"><span class="fs-17 text-uppercase">In approvazione</span></div>
                            </div>
                        </div>
                        
                        <div class="item-preview-banner">
                            <div class="preview-banner">
                                <img src="" data-banner-size="Format728x90" style="cursor: zoom-in;">
                                <div class="approvingly" data-format="Format728x90"><span class="fs-17 text-uppercase">In approvazione</span></div>
                            </div>
                        </div>

                    </div>

                    <div class="prev-preview"></div>
                    <div class="next-preview"></div>
                </div>
            </div>

        </div>

    </div>

    <div class="row mb-35 mt-10">
        <div class="col-xs-12 text-center">
            <button type="button" class="btn btn-adm btn-back text-uppercase m-30">Indietro</button>
            <a href="bulk-riepilogo" data-navigo class="btn btn-adm text-uppercase" id="submitter">Avanti</a>
        </div>
    </div>
</div>

<script>

    var currentPage;
    
    $(document).ready(function () {
    
        currentPage = navigationService.currentPage;
        
        // mostro in approvazione solo in caso di creativity caricata
        navigationService.currentPage.html.find('.approvingly').hide();
        currentPage.html.find('[data-toggle="tooltip"]').tooltip();
        
        /* Slider Preview */
        var handleSliderNavigation = function (item) {
            var paginatorsLink = currentPage.html.find('.switch-preview li');
            paginatorsLink.each(function (i) {
                if (item != i) {
                    $(paginatorsLink[i]).removeClass('selected');
                } else {
                    $(paginatorsLink[i]).addClass('selected');
                }
                $(paginatorsLink[i]).click(function () {
                    owl.trigger('to.owl.carousel', i);
                });
            });
        };
        var handleSlideChange = function (item) {
            currentPage.html.find('#creativityTitle').html(navigationService.currentPage.pagerTooltips[item]);
        };
        var owl = navigationService.currentPage.html.find('#slider-preview');
        owl.on('initialize.owl.carousel', function (elem) {
            handleSliderNavigation(elem, this);
        }).on('changed.owl.carousel', function (event) {
            var items = event.item.count; // Number of items
            var item = event.item.index;
            var left = navigationService.currentPage.html.find('.container-slider-preview').find('.prev-preview'),
                right = navigationService.currentPage.html.find('.container-slider-preview').find('.next-preview');
            handleSliderNavigation(item);
            handleSlideChange(item);
            if (item == 0) {
                left.hide();
            } else {
                left.show();
            }
            if (item == items - 1) {
                right.hide();
            } else {
                right.show();
            }
        }).owlCarousel({
            loop: false,
            nav: false,
            dots: false,
            margin: 10,
            items: 1
        });
        // Go to the next item
        currentPage.html.find('.next-preview').click(function () {
            owl.trigger('next.owl.carousel');
        });
        // Go to the previous item
        currentPage.html.find('.prev-preview').click(function () {
            owl.trigger('prev.owl.carousel');
        });
        /* Affix */
        /*currentPage.html.find('#affixPreview').affix({
            offset: {
                top: $('#affixPreview').offset().top,
                bottom: function () {
                    return (this.bottom = $('#offsetBottom').outerHeight(true))
                }
            }     
        });*/
        
        Dropzone.autoDiscover = false;
        
        var submitter = currentPage.html.find('#submitter'),
            form = currentPage.html.find('#form');
        
        $(".dropzone").each(function (i, e) {
            var t = $(this), format = t.data('format'), obj = {
                uploadMultiple: false,
                dictDefaultMessage: "Drag & Drop your file here or click",
                maxFilesize: t.data("maxsize"),
                acceptedFiles: t.data("filetype"),
                url: baseUrl + "/api/Banner/AddCustomBanner/" + BannerSize[t.data("format")],
                bannerSize: t.data("format"),
                pdvIndex: t.data("pdvindex"),
                maxFiles: 1,
                clickable: true,
                init: function () {
                    var dz = this;
                    this.on("addedfile", function (file) {
                        for (var i = 0; i < this.files.length; i++) if (this.files[i] != file) this.removeFile(this.files[i]);
                        t.trigger("change");
                    });
                    this.on("thumbnail", function (file) {
                        if (file.width != t.data("width") || file.height != t.data("height")) {
                            if (file.error) {
                                file.error("Le dimensioni dell'immagine non sono valide. Caricare un'immagine di risoluzione " + t.data("width") + "x" + t.data("height") + "px");
                            }
                        }
                        else if (file.done) { file.done(); }
                        t.trigger("change");
                    });
                    this.on("error", function (file, errorMessage) {
                        //console.log(errorMessage);
                        t.addClass("error").trigger("change");
                    });
                    this.on("success", function (file) {
                        t.removeClass("error").trigger("change");
                        navigationService.currentPage.dropzoneComplete(file.xhr, BannerSize[this.options.bannerSize]);
                    });
                    this.on("maxfilesreached", function (file) {
                        var el = t.parent();
                        if (!el.hasClass("complete")) el.addClass("complete");
                        t.trigger("change");
                    });
                    t.closest(".box-file").off("click").on("click", "a.btn", function () {
                        t.closest(".box-file").removeClass("complete");
                        dz.removeAllFiles(true);
                        t.trigger("change");
                        navigationService.currentPage.dropzoneRemove(BannerSize[dz.options.bannerSize]);
                    });
                },
                accept: function (file, done) {
                    file.done = done;
                    file.error = function (msg) { done(msg); };
                    if (!t.data("width")) return done();
                }
            };
            t.dropzone(obj);
        }).on('change', function () {
            var t = $(this),
                format = t.data('format'),
                parent = t.closest('.box-file'),
                appr = navigationService.currentPage.html.find('.approvingly[data-format=' + format + ']').stop();
            if (parent.hasClass('complete')) appr.fadeIn(300);
            else appr.fadeOut(100);
        });
        
        
        form.on('change keydown','input,.dropzone',function(){
            var bf = form.find('.box-file');
            //console.log('check '+(bf.length-bf.filter('.complete').length));
            if(form.find('.has-error,.dropzone.error').length || bf.filter('.complete').length < bf.length) submitter.attr('disabled','disabled');
            else submitter.removeAttr('disabled'); 
        }).find('.dropzone').trigger('change');
        
    });
</script>