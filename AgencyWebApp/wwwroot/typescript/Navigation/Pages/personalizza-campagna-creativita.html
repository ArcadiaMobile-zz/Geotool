<div class="bg-top">
    <div class="bg-grad">
        <div class="container" data-fluid>
            <div class="new-title uppercase mb-20 mb-160">CARICA LE CREATIVITà</div>
        </div>
    </div>
</div>

<form role="form" id="compaign_admove" class="personalizza mt-160-minus">
    <div class="container">
        <div class="row mt-50">
            <div class="col-lg-5 col-md-5">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="panel panel-default shadow">
                            <div class="panel-heading">
                                <span class="text-uppercase">Immagini</span>
                                <img data-image-logo src="assets/img/logo_cat.png" class="img-circle img-circle-admove pull-right" data-image>
                            </div>
                            <div class="panel-body mt-25">
                                <p class="hide app">
                                    Carica <b data-number-banner></b> per il tuo annuncio e le immagini per le <b>landing page</b> Smartphone e Tablet.<br>
                                </p>
                                <p class="hide facebook">
                                    Inserisci il tuo annuncio (titolo e descrizione) e carica il <b>banner</b> per la tua inserzione.<br>
                                    Carica inoltre le immagini per le <b>landing page</b> Smartphone e Tablet.
                                </p>
                                <p class="hide google">
                                    Inserisci il tuo annuncio (due titoli e descrizione) e le keyword della campagna.<br>
                                    Carica inoltre le <b>immagini</b> per le <b>landing page</b> Smartphone e Tablet.
                                </p>
                                <p class="color-light-green-water fs-13 m-0 lh-15">
                                    Le landing page utilizzate da AdMove hanno formati proprietari, assicurati di utilizzare il template a disposizione.
                                </p>
                                <p class="color-light-green-water fs-13 m-0 lh-15">
                                    Le creatività caricate sono soggette ad un processo di moderazione.
                                </p>
                                <div class="row">
                                    <div class="col-md-12">
                                        <a href="/assets/files/GuidelinesCreative.pdf" target="_blank" class="btn btn-adm alternative text-uppercase mt-15 mr-15">Visualizza istruzioni</a>
                                        <a href="/assets/files/LandingPageAdMove.zip" target="_blank" class="btn btn-adm alternative text-uppercase mt-15">Scarica il template</a>
                                    </div>
                                </div>
                                <!-- FACEBOOK -->
                                <div class="row" data-file="0">
                                    <div class="col-md-12 mt-50">
                                        <p class="fs-12"><span class="text-uppercase color-orange">FORMATO PUBBLICITARIO FACEBOOK</span><span class="text-uppercase"> 1200x628 px </span><i>(max 5Mb)</i></p>
                                        <div class="box-file">
                                            <div data-maxsize="5" data-filetype="image/*" data-format="Format1200x628" data-width="1200" data-height="628" data-required="true" class="dropzone mb30"></div>
                                            <a class="btn btn-adm flat text-uppercase my-10 pull-right clickable">Elimina</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- SMARTPHONE -->
                                <div class="row" data-file="2">
                                    <div class="col-md-12 mt-25">
                                        <p class="fs-12"><span class="text-uppercase color-orange">LANDING PAGE PER SMARTPHONE</span><span class="text-uppercase"> 640x1024 px </span><i>(max 200Kb)</i></p>
                                        <div class="box-file">
                                            <div data-maxsize="0.20" data-filetype="image/*" data-format="Format640x1024" data-width="640" data-height="1024" data-required="true" class="dropzone mb30" id="third-banner"></div>
                                            <a class="btn btn-adm flat text-uppercase my-10 pull-right clickable">Elimina</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- TABLET -->
                                <div class="row" data-file="3">
                                    <div class="col-md-12 mt-25">
                                        <p class="fs-12"><span class="text-uppercase color-orange">LANDING PAGE PER TABLET</span><span class="text-uppercase"> 2020x1320 px </span><i>(max 200Kb)</i></p>
                                        <div class="box-file">
                                            <div data-maxsize="0.20" data-filetype="image/*" data-format="Format2020x1320" data-width="2020" data-height="1320" data-required="true" class="dropzone mb30" id="fourth-banner"></div>
                                            <a class="btn btn-adm flat text-uppercase my-10 pull-right clickable">Elimina</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- BANNER 300x250 -->
                                <div class="row" data-file="4">
                                    <div class="col-md-12 mt-25">
                                        <p class="fs-12"><span class="text-uppercase color-orange">FORMATO RETTANGOLO MEDIO</span><span class="text-uppercase"> 300x250 px </span><i>(max 50Kb)</i></p>
                                        <div class="box-file">
                                            <div data-maxsize="0.05" data-filetype="image/*" data-format="Format300x250" data-width="300" data-height="250" data-required="true" class="dropzone mb30"></div>
                                            <a class="btn btn-adm flat text-uppercase my-10 pull-right clickable">Elimina</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- BANNER FORMATO INTERSTITIAL -->
                                <div class="row" data-file="5">
                                    <div class="col-md-12 mt-25">
                                        <p class="fs-12"><span class="text-uppercase color-orange">FORMATO INTESTITIAL</span><span class="text-uppercase"> 320x480 px </span><i>(max 80Kb)</i></p>
                                        <div class="box-file">
                                            <div data-maxsize="0.08" data-filetype="image/*" data-format="Format320x480" data-width="320" data-height="480" data-required="true" class="dropzone mb30"></div>
                                            <a class="btn btn-adm flat text-uppercase my-10 pull-right clickable">Elimina</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- BANNER 320x50 -->
                                <div class="row" data-file="6">
                                    <div class="col-md-12 mt-25">
                                        <p class="fs-12"><span class="text-uppercase color-orange">FORMATO LEADERBOARD SMARTPHONE</span><span class="text-uppercase"> 320x50 px </span><i>(max 50Kb)</i></p>
                                        <div class="box-file">
                                            <div data-maxsize="0.05" data-filetype="image/*" data-format="Format320x50" data-width="320" data-height="50" data-required="true" class="dropzone mb30"></div>
                                            <a class="btn btn-adm flat text-uppercase my-10 pull-right clickable">Elimina</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- BANNER 728x90 -->
                                <div class="row" data-file="7">
                                    <div class="col-md-12 mt-25">
                                        <p class="fs-12"><span class="text-uppercase color-orange">FORMATO LEADERBOARD TABLET</span><span class="text-uppercase"> 728x90 px </span><i>(max 50Kb)</i></p>
                                        <div class="box-file">
                                            <div data-maxsize="0.05" data-filetype="image/*" data-format="Format728x90" data-width="728" data-height="90" data-required="true" class="dropzone mb30"></div>
                                            <a class="btn btn-adm flat text-uppercase my-10 pull-right clickable">Elimina</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="panel-body bg-dark-blue" data-file="0">
                                <div class="form-group">
                                    <div class="input-group input-group-lg textarea-input col-xs-12">
                                        <textarea type="text" class="form-control input-flat" data-main-title rows="1" data-length="25" required></textarea>
                                        <label class="placeholder">Titolo</label>
                                    </div>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>
                            <div class="panel-body bg-dark-blue" data-file="0">
                                <div class="form-group mb-35">
                                    <div class="input-group input-group-lg textarea-input col-xs-12">
                                        <textarea type="text" class="form-control input-flat" data-main-description rows="3" data-length="90" required></textarea>
                                        <label class="placeholder">Descrizione</label>
                                    </div>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>
                            <div class="panel-body bg-dark-blue" data-file="1">
                                <div class="form-group">
                                    <div class="input-group input-group-lg textarea-input col-xs-12">
                                        <textarea type="text" class="form-control input-flat" data-main-headline rows="1" data-length="30" required></textarea>
                                        <label class="placeholder">Titolo 1</label>
                                    </div>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>
                            <div class="panel-body bg-dark-blue" data-file="1">
                                <div class="form-group">
                                    <div class="input-group input-group-lg textarea-input col-xs-12">
                                        <textarea type="text" class="form-control input-flat" data-main-row1 rows="1" data-length="30" required></textarea>
                                        <label class="placeholder">Titolo 2</label>
                                    </div>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>
                            <div class="panel-body bg-dark-blue" data-file="1">
                                <div class="form-group mb-35">
                                    <div class="input-group input-group-lg textarea-input col-xs-12">
                                        <textarea type="text" class="form-control input-flat" data-main-row2 rows="3" data-length="80" required></textarea>
                                        <label class="placeholder">Descrizione</label>
                                    </div>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>
                            <div class="panel-body" data-file="1">
                                <span class="text-uppercase fs-16 color-sky-blue">Keywords </span><i class="fs-12">(max 10 keywords)</i>
                                <div class="row">
                                    <div class="col-lg-12 mt-15">
                                        <div class="input-group">
                                            <input type="text" class="form-control keywords b-radius-2" value="" id="input-keywords" data-keyrequired="true">
                                            <span class="input-group-btn">
                                                <button type="button" class="btn btn-adm secondary text-uppercase b-radius-2 ml-15" id="gkeywords">Aggiungi</button>
                                            </span>
                                        </div>
                                        <div class="help-block with-errors"></div>
                                    </div>
                                </div>
                                <p class="color-light-green-water fs-13 m-0 lh-15 mt-15">
                                    Separa le keywords con virgole.
                                </p>
                                <input type="text" id="pkeywords">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xs-12">
                        <div class="panel panel-default mt-10 shadow _hide" id="graphic">
                            <div class="panel-heading pb-25"><span class="text-uppercase">Call to action landing page </span><b class="color-orange text-uppercase hide" data-pdv>(Punto <span class="number">1</span>)</b></div>
                            <div class="panel-body pb-0">
                                <script id="customUI-template" type="text/x-handlebars-template">
                                    <div class="pdv-info align-center hide" data-pdv>
                                        <div class="color-orange">{{userSession.originalBusinessName}}</div>
                                    </div>
                                    <div id="owl-graphic" class="owl-carousel owl-nav-top">
                                        {{#each userSession.pdvs}}
                                        <div class="item pb-20" data-calltoaction>
                                            <div class="pdv-info align-center mb-20 hide" data-pdv>
                                                {{address}}
                                            </div>
                                            <div class="owl-panel-inset _bg-dark-blue">
                                                <div class="fs-13">Seleziona e configura le azioni che l'utente potrà effettuare e le informazioni di contatto che verranno mostrate sulla landing page.</div>
                                                <div class="cta error-message py-10 mt-10 text-center">Seleziona almeno un'opzione</div>
                                                <div class="row mt-15 pb-20 calltoaction" data-type="map">
                                                    <div class="col-md-12 pb-20">
                                                        <div class="pull-left mt--10">
                                                            <input type="checkbox" class="filled-in" name="link-map" data-link-map id="link-map{{@index}}" checked="checked">
                                                            <label for="link-map{{@index}}"></label>
                                                        </div>
                                                        <div class="panel-heading p-0 text-uppercase color-sky-blue ib">Click to Map <span class="info-badge pull-right ml-10" data-toggle="tooltip" data-placement="top" data-original-title="Inserisci l'indirizzo dell'attività per permettere agli utenti di sapere come raggiungere l'attività"></span></div>
                                                    </div>
                                                    <div class="col-md-12 pt-20">
                                                        <div class="form-group">
                                                            
                                                            <div class="input-group input-group-lg">
                                                                <span class="input-group-addon"><span class="input-ico ico-link"></span></span>
                                                                <input type="text" class="form-control b-radius-right-2" value="{{clickToMap}}" data-ctm="{{address}}" data-link-map data-valid="1">
                                                                <label class="placeholder">Inserisci il link</label>
                                                            </div>
                                                            <div class="buttons hide mt-5 text-right">
                                                                <a class="btn update" data-action="update" data-pdv data-toggle="tooltip" title="Valida l'indirizzo inserito"><b class="ico"></b><span></span>Valida indirizzo</a>
                                                                <a class="btn reset" data-action="reset" data-pdv data-toggle="tooltip" title="Ripristina l'indirizzo inserito"><b class="ico"></b><span></span>Ripristina indirizzo</a>
                                                            </div>
                                                            <div class="help-block with-errors"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row mt-35 calltoaction" data-type="call">
                                                    <div class="col-md-12 pb-20">
                                                        <div class="pull-left mt--10">
                                                            <input type="checkbox" class="filled-in" name="link-call" data-link-call id="link-call{{@index}}">
                                                            <label for="link-call{{@index}}"></label>
                                                        </div>
                                                        <div class="panel-heading p-0 text-uppercase color-sky-blue ib">Click to Call <span class="info-badge pull-right ml-10" data-toggle="tooltip" data-placement="top" data-original-title="Inserisci il numero di telefono che vuoi che gli utenti chiamino per avere informazioni sull'attività"></span></div>
                                                    </div>
                                                    <div class="col-md-12 pt-20">
                                                        <div class="form-group">
                                                            <div class="input-group input-group-lg">
                                                                <span class="input-group-addon"><span class="input-ico ico-phone"></span></span>
                                                                <input type="text" class="form-control b-radius-right-2" data-link-call value="{{phoneNumber}}" pattern="^[0-9]{8,12}$" data-error="Inserisci un numero di telefono valido composto da 8 a 12 numeri" required>
                                                                <label class="placeholder">Inserisci il numero di telefono</label>
                                                            </div>
                                                            <div class="help-block with-errors"></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        {{/each}}
                                    </div>
                                    <script>
                                        var currentPage = navigationService.currentPage;
                                        var owlGraphic = $('#owl-graphic');
                                        owlGraphic.owlCarousel({
                                            loop: false,
                                            nav: true,
                                            dots: false,
                                            autoHeight: true,
                                            mouseDrag: false,
                                            touchDrag: false,
                                            margin: 50,
                                            items: 1,
                                            stageOuterClass: 'owl-stage-outer owl-panel',
                                            navText: ['', '']
                                        }).on('changed.owl.carousel', function (event) {
                                            currentPage.contactsCarouselChanged(event.item.index);
                                            owlGraphic.trigger('pdv:change',[event.item.index]);
                                        });
                                    </script>
                                </script>
                                <div class="cta error-message hide py-10 color-red">Seleziona almeno un'opzione</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 col-lg-offset-1 col-md-7 col-md-offset-0 mb-35">
                <div id="affixPreview">
                    <p class="color-sky-blue fs-17 text-uppercase text-center my-15">Anteprima grafica <b class="color-orange text-uppercase hide" data-pdv>(Punto <span class="number">1</span>)</b></p>
                    <p class="fs-16 text-center mt-35" id="creativityTitle">Landing page per smartphone</p>
                    <ul class="switch-preview text-center">
                        <li class="switch-facebook selected"></li>
                        <li class="switch-search"></li>
                        <li class="switch-smartphone"></li>
                        <li class="switch-tablet"></li>
                        <li class="switch-banner-1"></li>
                        <li class="switch-interstitial"></li>
                        <li class="switch-banner-3"></li>
                        <li class="switch-banner-2"></li>
                    </ul>
                    <div class="container-slider-preview">
                        <div id="slider-preview" class="owl-carousel">
                            <!-- FACEBOOK -->
                            <div class="item-preview-device">
                                <div class="smartphone facebook nocta">
                                    <div class="mask-top"></div>
                                    <div class="abs">
                                        <div class="title uppercase"></div>
                                        <div class="description" title=""></div>
                                        <span data-bannerid="3">
                                            <img data-banner-size="Format1200x628" src="" style="cursor: zoom-in;">
                                        </span>
                                    </div>
                                    <div class="preview-display">
                                        <img src="assets/img/facebook_template.jpg">
                                    </div>
                                    <div class="mask-bottom"></div>
                                </div>
                            </div>
                            <!-- GOOGLE -->
                            <div class="item-preview-device">
                                <div class="smartphone search nocta">
                                    <div class="mask-top"></div>
                                    <div class="abs">
                                        <div class="headline uppercase" title="">Titolo 1</div>
                                        <div class="row1" title="">Titolo 2</div>
                                        <div class="website" title=""></div>
                                        <div class="row2" title="">Descrizione</div>
                                    </div>
                                    <div class="preview-display">
                                        <img src="assets/img/google_template.jpg">
                                    </div>
                                    <div class="mask-bottom"></div>
                                </div>
                            </div>
                            <!-- SMARTPHONE -->
                            <div class="item-preview-device">
                                <div class="smartphone">
                                    <div class="mask-top"></div>
                                    <div class="preview-display">
                                        <img src="" data-banner-size="Format640x1024" style="cursor: zoom-in;">
                                        <div class="approvingly" data-format="Format640x1024"><span class="fs-17 text-uppercase">In<br>approvazione</span></div>
                                    </div>
                                    <div class="mask-bottom"></div>
                                </div>
                            </div>
                            <!-- TABLET -->
                            <div class="item-preview-device">
                                <div class="tablet">
                                    <div class="preview-display">
                                        <img src="" data-banner-size="Format2020x1320" style="cursor: zoom-in;">
                                        <div class="approvingly" data-format="Format2020x1320"><span class="fs-17 text-uppercase">In<br>approvazione</span></div>
                                    </div>
                                </div>
                            </div>
                            <!-- BANNER 300x250 -->
                            <div class="item-preview-banner">
                                <div class="preview-banner">
                                    <img src="" data-banner-size="Format300x250" style="cursor: zoom-in;">
                                    <div class="approvingly" data-format="Format300x250"><span class="fs-17 text-uppercase">In<br>approvazione</span></div>
                                
                                </div>
                            </div>
                            <!-- BANNER INTERSTITIAL -->
                            <div class="item-preview-banner">
                                <div class="preview-banner">
                                    <img src="" data-banner-size="Format320x480" style="cursor: zoom-in;">
                                    <div class="approvingly" data-format="Format320x480"><span class="fs-17 text-uppercase">In approvazione</span></div>
                                </div>
                            </div>
                            <!-- BANNER 320x50 -->
                            <div class="item-preview-banner">
                                <div class="preview-banner">
                                    <img src="" data-banner-size="Format320x50" style="cursor: zoom-in;">
                                    <div class="approvingly" data-format="Format320x50"><span class="fs-17 text-uppercase">In approvazione</span></div>
                                </div>
                            </div>
                            <!-- BANNER 728x90 -->
                            <div class="item-preview-banner">
                                <div class="preview-banner">
                                    <img src="" data-banner-size="Format728x90" style="cursor: zoom-in;">
                                    <div class="approvingly" data-format="Format728x90"><span class="fs-17 text-uppercase">In approvazione</span></div>
                                </div>
                            </div>
                        </div>
                        <div class="prev-preview"></div>
                        <div class="next-preview"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mb-35" id="offsetBottom">
            <div class="col-xs-12 text-center">
                <button type="button" class="btn btn-adm btn-back text-uppercase m-30">Indietro</button>
                <button type="button" class="btn btn-adm text-uppercase m-30" id="submitter">Scegli una data</button>
            </div>
        </div>
    </div>
</form>
<script>

    var currentPage;

    $(document).ready(function () {             
        currentPage = navigationService.currentPage;
                                        
        // mostro in approvazione solo in caso di creativity caricata
        currentPage.html.find('.approvingly').hide();

        $('#compaign_loaded').on('click', '[data-toggle="lightbox"]', function (event) {
            event.preventDefault();
            $(this).ekkoLightbox();
        });

        $('[data-toggle="tooltip"]').tooltip();

        /* Slider Preview */
        var handleSliderNavigation = function (item) {

            var paginatorsLink = $('.switch-preview li');

            paginatorsLink.each(function (i) {
                if (item != i) {
                    $(paginatorsLink[i]).removeClass('selected');
                } else {
                    $(paginatorsLink[i]).addClass('selected');
                }
                $(paginatorsLink[i]).click(function () {
                    owl.trigger('to.owl.carousel', i);
                });
            });

        };

        var handleSlideChange = function (item) {
            $('#creativityTitle').html(currentPage.pagerTooltips[item]);
        };

        var owl = currentPage.html.find('#slider-preview');
        
        owl.on('initialize.owl.carousel', function (elem) {
            handleSliderNavigation(elem, this);
        }).on('changed.owl.carousel', function (event) {
            var items = event.item.count; // Number of items
            var item = event.item.index;

            var left = currentPage.html.find('.container-slider-preview').find('.prev-preview'), right = currentPage.html.find('.container-slider-preview').find('.next-preview');

            handleSliderNavigation(item);
            handleSlideChange(item);

            if (item == 0) {
                left.hide();
            } else {
                left.show();
            }
            if (item == items - 1) {
                right.hide();
            } else {
                right.show();
            }

        }).owlCarousel({
            loop: false,
            nav: false,
            dots: false,
            margin: 10,
            items: 1
        });
        // Go to the next item
        $('.next-preview').click(function () {
            owl.trigger('next.owl.carousel');
        });
        // Go to the previous item
        $('.prev-preview').click(function () {
            owl.trigger('prev.owl.carousel');
        });

        /* Affix */
        $('#affixPreview').affix({
            offset: {
                top: $('#affixPreview').offset().top,
                bottom: function () {
                    return (this.bottom = $('#offsetBottom').outerHeight(true))
                }
            }
        });

        /*
        * Keywords
        * https://bootstrap-tagsinput.github.io/bootstrap-tagsinput/examples/
        *
        */

        $(function () {
            $('#pkeywords').tagsinput({
                maxTags: 10
            });
        });

        $('#gkeywords').click(function () {
            var addKeywords = $('#input-keywords').val();
            $('#pkeywords').tagsinput('add', addKeywords);
            $('#input-keywords').val('').focus();

            $('#pkeywords').tagsinput('refresh');
            var elt = $('#pkeywords').tagsinput('items');
        });

        /*
        * Pickadate init
        *
        *
        */
        var submitter = $('#submitter'),
            form = $('form#compaign_admove'),
            calendar_text = $('<div class="media py-20 bg-blue"><div class="media-left media-middle px-37 br-dark-1"><div class="bg-white b-radius-50p p-20"><img class="media-object" src="assets/img/ico-calendar.png" alt=""></div></div><div class="media-body media-middle p-20 color-white"><p class="text-uppercase"><b>Seleziona la data di partenza</b></p><p class="m-0">Scegli il periodo più indicato per lanciare la tua campagna.</p></div></div>'),
            calendar_button = $('<div class="bg-blue text-center"><button type="submit" class="btn btn-adm text-uppercase my-35">Scopri la tua campagna</button></div>');

        var input = $('<input type="text">').hide().appendTo(form);                                  
        input.pickadate({
            // Strings and translations
            monthsFull: ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'],
            monthsShort: ['Gen', 'Feb', 'Mar', 'Apr', 'Mag', 'Giu', 'Lug', 'Ago', 'Set', 'Ott', 'Nov', 'Dic'],
            weekdaysFull: ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab'],
            weekdaysShort: ['Do', 'Lu', 'Ma', 'Me', 'Gi', 'Ve', 'Sa'],
            // Buttons
            today: '',
            clear: '',
            close: '',
            // Accessibility labels
            labelMonthNext: 'Prossimo mese',
            labelMonthPrev: 'Mese precedente',
            labelMonthSelect: 'Seleziona un mese',
            labelYearSelect: 'Seleziona un anno',
            showWeekdaysFull: true,
            firstDay: 1,
            format: 'dd/mm/yyyy',
            closeOnSelect: true,
            closeOnClear: true,
            min: currentPage.minCampaignDate,
            //max: currentPage.maxCampaignDate,
            disable: navigationService.currentPage.disableHolidayWeekendDays,
            onSet: function (context) {
                var val = this.get('select', 'dd/mm/yyyy');
                currentPage.datePickerSelect(this.get('select').obj);
            },
            onOpen: function (context) {
                console.log('onopen');
                setTimeout(function () { // aggiungo gli elementi
                    currentPage.html.find('.picker__wrap').prepend(calendar_text).append(calendar_button);
                }, 100);
            }
        }).pickadate('picker').set('select', currentPage.minCampaignDate);
                                            
        var pd = input.pickadate('picker');
                                            
        submitter.on('click',function(evt){
            evt.stopPropagation();
            evt.preventDefault();
                                            
            if($(this).hasClass('disabled')) return false;                                  
            pd.open(); 
        });
                                                                                
        form.validator({
            custom: {
                length: function ($el) {
                    var matchValue = $el.data("length") // foo
                    if ($el.val().length > matchValue) {
                        return "Non inserire più di " + matchValue + " caratteri"
                    }
                },
                valid: function($el) {
                    var valid = $el.data("valid");
                    if($el.is(':enabled') && valid != 1) return "  ";
                }
            }
        });

        Dropzone.autoDiscover = false;

        $(".dropzone").each(function (i, e) {
            var t = $(this), format = t.data('format'), obj = {
                uploadMultiple: false,
                dictDefaultMessage: "Drag & Drop your file here or click",
                maxFilesize: t.data("maxsize"),
                acceptedFiles: t.data("filetype"),
                url: baseUrl + "/api/Banner/AddCustomBanner/" + BannerSize[t.data("format")],
                bannerSize: t.data("format"),
                pdvIndex: t.data("pdvindex"),
                maxFiles: 1,
                clickable: true,
                init: function () {

                    var dz = this;

                    this.on("addedfile", function (file) {
                        for (var i = 0; i < this.files.length; i++) if (this.files[i] != file) this.removeFile(this.files[i]);
                        t.trigger("change");
                    });

                    this.on("thumbnail", function (file) {
                        if (file.width != t.data("width") || file.height != t.data("height")) {
                            if (file.error) {
                                file.error("Le dimensioni dell'immagine non sono valide. Caricare un'immagine di risoluzione " + t.data("width") + "x" + t.data("height") + "px");
                            }
                        }
                        else if (file.done) { file.done(); }
                        t.trigger("change");
                    });
                                                        
                    this.on("error", function (file, errorMessage) {
                        //console.log(errorMessage);
                        t.addClass("error").trigger("change");
                    });
                                                        
                    this.on("success", function (file) {
                        t.removeClass("error").trigger("change");
                        currentPage.dropzoneComplete(file.xhr, BannerSize[this.options.bannerSize], this.options.pdvIndex);
                    });
                                                        
                    this.on("maxfilesreached", function (file) {
                        var el = t.parent();
                        if (!el.hasClass("complete")) el.addClass("complete");
                        t.trigger("change");
                    });

                    t.closest(".box-file").off("click").on("click", "a.btn", function () {
                        t.closest(".box-file").removeClass("complete");
                        dz.removeAllFiles(true);
                        t.trigger("change");
                        currentPage.dropzoneRemove(BannerSize[dz.options.bannerSize], dz.options.pdvIndex);
                    });

                },
                accept: function (file, done) {
                    //console.log("accept");
                    file.done = done;
                    file.error = function (msg) { done(msg); };
                    if (!t.data("width")) return done();
                }
            };

            t.dropzone(obj);

        }).on('change',function(){
            var t = $(this), format = t.data('format'), parent = t.closest('.box-file'), appr = currentPage.html.find('.approvingly[data-format='+format+']').stop();
            if(parent.hasClass('complete')) appr.addClass('complete').fadeIn(300);
            else appr.removeClass('complete').fadeOut(100);

            owlGraphic.trigger('pdv:change');
                                                
        });
        
        // call to action
        var cta_img = {},
            error_message = currentPage.html.find('.cta.error-message'); // oggetto relativo alle immagini per pdv
        
        function change_cat_image(type){
            owl.find('img.cta').remove();
        
            if(!type || type == 'null') return;
            
            if(owl.find('.smartphone:not(.nocta) .approvingly').hasClass('complete')) owl.find('.smartphone:not(.nocta) .preview-display').prepend('<img class="cta" src="/assets/img/cta/smartphone-' + type + '.png" />');
            if(owl.find('.tablet .approvingly').hasClass('complete')) owl.find('.tablet .preview-display').prepend('<img class="cta" src="/assets/img/cta/tablet-'+type+'.png" />');
        }
        
        currentPage.html.on('change','[data-calltoaction]  input[type=checkbox]',function(){
            var t = $(this),
                checked = t.is(':checked'),
                box = t.closest('.calltoaction'),
                type = box.data('type'),
                input = box.find('input[type=text]'),
                fg = input.closest('.form-group'),
                owl = t.closest('.owl-item'),
                index = owl.index(),
                otype = owl.find('[data-type]').not('[data-type="'+type+'"]').data('type'),
                otype_checked = owl.find('[data-type]').not('[data-type="'+type+'"]').find('input[type=checkbox]').is(':checked');

            if(!cta_img[index]) cta_img[index] = type;

            owl.find('.form-group').removeClass('has-error');
            error_message.removeClass('color-red');

            if(checked){

                fg.removeClass('disabled');
                input.removeAttr('disabled');

                if(otype_checked) cta_img[index] = 'both';
                else cta_img[index] = type;

            }else{

                fg.addClass('disabled');
                input.attr('disabled','disabled');

                if(otype_checked) cta_img[index] = otype;
                else{
                    cta_img[index] = 'null';
                    owl.find('.form-group').addClass('has-error');
                    error_message.addClass('color-red');
                }
            }
            
            input.trigger('change');
            change_cat_image(cta_img[index]);

        }).on('click','[data-action][data-pdv]', async function(evt){ // bottoni di validazione e reset
            evt.preventDefault();
            var t = $(this), action = t.data('action'), fg = t.closest('.form-group'), input = fg.find('[data-ctm]');

            if (action == 'reset') {
                return input.val(input.data('ctm')).data('valid', 1).trigger('keydown').trigger('change');
            }

            if(t.hasClass('loading')) return false;

            if (input.val().length > 0) {
                t.addClass('loading');

                var address = await navigationService.currentPage.verifyAddress(input.val());

                setTimeout(function () {
                    t.removeClass('loading').addClass('disabled').removeClass('npulse');

                    if (address) {
                        input.val(address).data('valid', 1).trigger('change', [true]);
                    }
                }, 1000);
            }
        }).on('change keyup','[data-ctm]',function(evt,v){ // input click to map
            var t = $(this), fg = t.closest('.form-group'), old = t.data('ctm'), val = t.val(), valid = t.data('valid');
            var btns = fg.find('a[data-action]').removeClass('npulse');

            if(v) return false;
            
            if(val == old){
                btns.addClass('disabled');
                btns.closest('.buttons').addClass('hide');
                t.data('valid',1); // permetto di proseguire il flusso
            }else{
                btns.removeClass('disabled');
                btns.closest('.buttons').removeClass('hide');
                t.data('valid',0); // impedisco di proseguire il flusso
            }

            if(!btns.filter('.update').hasClass('disabled')){
                setTimeout(function(){
                    btns.filter('.update').addClass('npulse');
                },50);
            }

        });
        
        owlGraphic.on('pdv:change',function(evt,index){
            setTimeout(function(){
                owlGraphic.find('.owl-item.active input[type=checkbox]:first').trigger('change');
            },100);
        }).trigger('pdv:change',[0]);

        CMS.check(form, submitter, function (evt, errors) {
            //if (!evt.isDefaultPrevented()) {
            if(!errors){
                evt.preventDefault();
                currentPage.goToRiepilogo.call(currentPage, evt);
            }
        });
        
        // single/multiple
        if( navigationService._userSession.pdvs.length > 1) currentPage.html.find('[data-pdv]').removeClass('hide');
        
    });
</script>
