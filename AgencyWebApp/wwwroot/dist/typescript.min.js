function delay(e){return new Promise(function(t){setTimeout(t,e)})}var __extends=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{c(n.next(e))}catch(e){r(e)}}function a(e){try{c(n.throw(e))}catch(e){r(e)}}function c(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}c((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return n([e,t])}}function n(i){if(s)throw new TypeError("Generator is already executing.");for(;c;)try{if(s=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){c.label=i[1];break}if(6===i[0]&&c.label<o[1]){c.label=o[1],o=i;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(i);break}o[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],r=0}finally{s=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var s,r,o,a,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},__assign=this&&this.__assign||function(){return __assign=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},__assign.apply(this,arguments)};moment.prototype.userLocale=function(){var e=(navigator.language||navigator.browserLanguage).slice(0,2);return this.locale(e)},moment.prototype.addWorkdays=function(e){for(var t=e/Math.abs(e),i=this.clone().add(7*Math.floor(Math.abs(e)/5)*t,"days"),n=e%5;0!=n;)i.add(t,"days"),6!==i.isoWeekday()&&7!==i.isoWeekday()&&(n-=t);return i},Number.prototype.toPriceFormat=function(){var e=Math.round(Math.abs(this)%1*100).toString();return 1===e.length&&(e+="0"),[Math.trunc(this).toLocaleString(),e]},String.prototype.formatDate||(String.prototype.formatDate=function(){return moment.parseZone(this).local().format("DD/MM/YY")}),String.prototype.uriFormat||(String.prototype.uriFormat=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var i=1;i<e.length;i++)e[i]=encodeURIComponent(e[i]);return this.format.apply(this,e)}),String.prototype.parseQuery||(String.prototype.parseQuery=function(){for(var e={},t=this.indexOf("?"),i=(t>=0?this.substr(t+1):this).split("&"),n=0;n<i.length;n++){var s=i[n].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]||"")}return e}),String.prototype.format||(String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(t,i){return"undefined"!=typeof e[i]?e[i]:t})}),Date.prototype.addDays||(Date.prototype.addDays=function(e){var t=new Date(this.valueOf());return t.setDate(t.getDate()+e),t}),String.prototype.toMoment||(String.prototype.toMoment=function(){return moment(this,"YYYY-MM-DD").toDate()}),String.prototype.toMomentObject||(String.prototype.toMomentObject=function(){return moment(this,"YYYY-MM-DD")}),function(e){e.fn.textAndTitle=function(t){return this.each(function(){e(this).text(t).attr("title",t)})}}(jQuery),Handlebars.registerHelper("times",function(e,t){for(var i="",n=0;n<e;++n)i+=t.fn(n);return i});var EvaluationObjective;!function(e){e[e.PromotionPrice=0]="PromotionPrice",e[e.PromotionDiscount=1]="PromotionDiscount",e[e.NewOffer=2]="NewOffer",e[e.Branding=3]="Branding",e[e.AnotherTarget=4]="AnotherTarget"}(EvaluationObjective||(EvaluationObjective={}));var AdvertisementType;!function(e){e[e.DISPLAYCLICK=0]="DISPLAYCLICK",e[e.DISPLAYUU=1]="DISPLAYUU",e[e.SOCIALFB=2]="SOCIALFB",e[e.SMS=3]="SMS",e[e.SEARCHGOOGLE=4]="SEARCHGOOGLE",e[e.FLYER=5]="FLYER"}(AdvertisementType||(AdvertisementType={}));var GenderType;!function(e){e[e.BOTH=0]="BOTH",e[e.MALE=1]="MALE",e[e.FEMALE=2]="FEMALE"}(GenderType||(GenderType={}));var CampaignStatusEnum;!function(e){e[e.All=0]="All",e[e.Active=1]="Active",e[e.Scheduled=2]="Scheduled",e[e.End=3]="End",e[e.ToApprove=4]="ToApprove",e[e.Waiting=5]="Waiting",e[e.Rejected=6]="Rejected"}(CampaignStatusEnum||(CampaignStatusEnum={}));var BannerSize;!function(e){e[e.Format300x250=0]="Format300x250",e[e.Format320x50=1]="Format320x50",e[e.Format728x90=2]="Format728x90",e[e.Format1200x628=3]="Format1200x628",e[e.Format640x1024=4]="Format640x1024",e[e.Format2020x1320=5]="Format2020x1320",e[e.Format320x480=6]="Format320x480",e[e.None=7]="None"}(BannerSize||(BannerSize={}));var GeocodeStatus;!function(e){e[e.OK=0]="OK",e[e.ZERO_RESULTS=1]="ZERO_RESULTS",e[e.OVER_QUERY_LIMIT=2]="OVER_QUERY_LIMIT",e[e.REQUEST_DENIED=3]="REQUEST_DENIED",e[e.INVALID_REQUEST=4]="INVALID_REQUEST",e[e.UNKNOW_ERROR=5]="UNKNOW_ERROR"}(GeocodeStatus||(GeocodeStatus={}));var ServiceAgentContext=function(){function e(e){this.baseUrl=e,this.reload()}return e.prototype.reload=function(){void 0!==$.cookie&&(this._accessToken=$.cookie("accessToken"))},Object.defineProperty(e.prototype,"accessToken",{get:function(){return this._accessToken},set:function(e){this._accessToken=e,e&&void 0!==$.cookie?$.cookie("accessToken",e,{expires:this.accessTokenExpiration}):$.removeCookie("accessToken")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"accessTokenObject",{get:function(){return this.accessToken?jwt_decode(this.accessToken):{}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"accessTokenExpiration",{get:function(){if(this.accessTokenObject.exp)return moment.unix(this.accessTokenObject.exp).toDate()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"accessTokenExpired",{get:function(){return!this.accessTokenExpiration||new Date>=this.accessTokenExpiration},enumerable:!0,configurable:!0}),e}(),ServiceAgent=function(){function e(e){this.context=e}return e.prototype.doCall=function(e,t){var i=this,n=this.context.baseUrl;n+="string"==typeof e.uri?e.uri:e.uri(t);var s,r={method:e.method||"GET",url:n,contentType:"application/json",beforeSend:function(e){e.setRequestHeader("Authorization","bearer "+i.context.accessToken)}};return e.body&&(s=e.body(t),s instanceof FormData?(r.contentType=!1,r.processData=!1):"object"==typeof s&&(s=JSON.stringify(s)),r.data=s),new Promise(function(t,i){r.success=function(i){return t(e.responseCallback?e.responseCallback(i):i)},r.error=function(e,t,n){return i(new Error(n))},$.ajax(r)})},e.prototype.formatUri=function(e,t,i){if(t)for(var n=0,s=t;n<s.length;n++){var r=s[n];e.endsWith("/")||(e+="/"),e+=encodeURIComponent(r)}if(i){e.endsWith("?")||(e+="?");var o=!0;for(var r in i)"undefined"!=typeof i[r]&&(o||(e+="&"),e+=encodeURIComponent(r)+"="+encodeURIComponent(i[r]),o=!1)}return e},e}(),AutoServiceAgent=function(e){function t(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];for(var s=e.call(this,t)||this,r=s,o=function(e){r[e.name]=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return s.doCall(e,t)}},a=0,c=i;a<c.length;a++){var u=c[a];o(u)}return s}return __extends(t,e),t}(ServiceAgent),ServiceAgentFactory=function(){function e(){}return e.get=function(t){return new t(e.context)},e}(),BusinessCategoryServiceAgent=function(e){function t(t){return e.call(this,t,{name:"getAll",uri:"/api/BusinessCategory"})||this}return __extends(t,e),t}(AutoServiceAgent),CampaignServiceAgent=function(e){function t(t){var i=e.call(this,t,{name:"getAll",uri:"/api/Campaign"},{name:"get",uri:function(e){return i.formatUri("/api/Campaign",e)}},{name:"moreProducts",uri:function(e){return i.formatUri("/api/Campaign/MoreProducts",[],{proposalItemId:e[0],diagnosticData:e[1]||!1})}},{name:"moreProductsBulk",method:"POST",uri:function(e){return i.formatUri("/api/Campaign/MoreProductsBulk")},body:function(e){return e[0]}},{name:"moreCopyItems",uri:function(e){return i.formatUri("/api/Campaign/MoreCopyItems",[],{proposalProductItemId:e[0]})}},{name:"moreBanners",uri:function(e){return i.formatUri("/api/Campaign/MoreBanners",[],{proposalCopyItemId:e[0]})}},{name:"evaluate",method:"POST",uri:function(e){return i.formatUri("/api/Campaign/Evaluate")},body:function(e){return e[0]}},{name:"evaluateBulk",uri:"/api/Campaign/EvaluateBulk"},{name:"prepareCampaignGroupDraft",method:"POST",uri:function(e){return i.formatUri("/api/Campaign/PrepareCampaignGroupDraft")},body:function(e){return e[0]}},{name:"bulkPrepareCampaign",method:"POST",uri:function(e){return i.formatUri("/api/Campaign/BulkPrepareCampaign")},body:function(e){return e[0]}},{name:"handleCampaignPayment",method:"POST",uri:function(e){return i.formatUri("/api/Campaign/HandleCampaignPayment",e)}},{name:"renameCampaign",method:"POST",uri:function(e){return i.formatUri("/api/Campaign/Rename",[e[0]])},body:function(e){return JSON.stringify(e[1])}},{name:"getSeo",uri:function(e){return i.formatUri("/api/Campaign/Seo",[],{businessName:e[0]})}},{name:"getDeliveryDays",method:"GET",uri:function(e){return i.formatUri("/api/Campaign/Bulk/"+e[0],void 0,void 0)}},{name:"getBulkMaxBudget",method:"GET",uri:"/api/Campaign/MaxBudget"})||this;return dev.fakeCampaign&&(i.evaluate=function(){return Promise.resolve(JSON.parse('{"Proposals":[{"ProposalInfo":{"CreatedOn":"2017-05-09T13:46:36.246397+00:00","Name":"","Description":"DISPLAYUU","Efficacy":1.0,"MinBudget":0.0,"MaxBudget":0.0},"Id":"ec13b17e65de40759e0deb5965d30b38","EstimatedDuration":"14.00:00:00","Tracing":"","ProposalType":"ProposalItem","AdvertisementType":"DISPLAYUU","CampaignProviderId":"APPNEXUS","Products":[]},{"ProposalInfo":{"CreatedOn":"2017-05-09T13:46:36.246397+00:00","Name":"","Description":"SOCIALFB","Efficacy":0.9,"MinBudget":0.0,"MaxBudget":0.0},"Id":"9e53734547874c698359abb8a31fd497","EstimatedDuration":"14.00:00:00","Tracing":"","ProposalType":"ProposalItem","AdvertisementType":"SOCIALFB","CampaignProviderId":"FACEBOOK","Products":[]},{"ProposalInfo":{"CreatedOn":"2017-05-09T13:46:36.246397+00:00","Name":"","Description":"DISPLAYCLICK","Efficacy":0.8,"MinBudget":0.0,"MaxBudget":0.0},"Id":"764484b08ed049ed8634c59998833976","EstimatedDuration":"14.00:00:00","Tracing":"","ProposalType":"ProposalItem","AdvertisementType":"DISPLAYCLICK","CampaignProviderId":"APPNEXUS","Products":[]},{"ProposalInfo":{"CreatedOn":"2017-05-09T13:46:36.246397+00:00","Name":"","Description":"SEARCHGOOGLE","Efficacy":0.3,"MinBudget":0.0,"MaxBudget":0.0},"Id":"61b6dc80599146ae95014daf5b5360f7","EstimatedDuration":"14.00:00:00","Tracing":"","ProposalType":"ProposalItem","AdvertisementType":"SEARCHGOOGLE","CampaignProviderId":"GOOGLE","Products":[]},{"ProposalInfo":{"CreatedOn":"2017-05-09T13:46:36.246397+00:00","Name":"","Description":"SMS","Efficacy":0.2,"MinBudget":0.0,"MaxBudget":0.0},"Id":"3f619106feb14c709c52d9efc9840745","EstimatedDuration":"14.00:00:00","Tracing":"","ProposalType":"ProposalItem","AdvertisementType":"SMS","CampaignProviderId":"APPNEXUS","Products":[]}],"Tracing":null,"MobileUserRadius":1500,"CompetitorsNumber":20}'))},i.moreProducts=function(){return Promise.resolve(JSON.parse('{"ProposalInfo":{"CreatedOn":"2017-06-06T08:20:48.2675292+00:00","Name":"","Description":"DISPLAYUU","Efficacy":1.0,"MinBudget":0.0,"MaxBudget":0.0},"Id":"c542f2ad36cc45dcb9491f16b2eec779","EstimatedDuration":"14.00:00:00","Tracing":"AdvertisementType: DISPLAYUU MobileUsers: 34508 MobileUserRadius: 3000 AreaType: Urbana ","ProposalType":"ProposalItem","AdvertisementType":"DISPLAYUU","CampaignProviderId":"APPNEXUS","Products":[{"Id":"AQc=","Price":180.00,"VAT":39.60,"EstimatedDuration":"30.00:00:00","Value":6000,"Description":"Descrizione prod - lorem ipsum - 7","CopyItems":[]},{"Id":"AQk=","Price":225.00,"VAT":49.50,"EstimatedDuration":"30.00:00:00","Value":7500,"Description":"Descrizione prod - lorem ipsum - 9","CopyItems":[]},{"Id":"AQs=","Price":300.00,"VAT":66.00,"EstimatedDuration":"30.00:00:00","Value":10000,"Description":"Descrizione prod - lorem ipsum - 11","CopyItems":[]},{"Id":"AQ0=","Price":450.00,"VAT":99.00,"EstimatedDuration":"30.00:00:00","Value":15000,"Description":"Descrizione prod - lorem ipsum - 13","CopyItems":[]}]}'))},i.moreCopyItems=function(){return Promise.resolve(JSON.parse('{"Id":"AQc=","Price":180.00,"VAT":39.60,"EstimatedDuration":"30.00:00:00","Value":6000,"Description":"Descrizione prod - lorem ipsum - 7","CopyItems":[{"SuggestedTitle":"Ordina ciò che vuoi.","SuggestedDescription":"Il nostro menù è così vario che faremo fatica a proporti qualcosa che non corrisponda esattamente a ciò che desideri. Vieni a provarlo.","Id":"a407d88246b54818841d43138fec87c2","BannerIds":["IT.RS0100a.0101.0100-a501"]},{"SuggestedTitle":"C’è più gusto nella tradizione.","SuggestedDescription":"L’eccellenza a tavola non si trova dappertutto.Smetti di cercarla: ti proponiamo un menù che riscopre la tradizione, solo con ingredienti freschi e di stagione.","Id":"a67565a905ae4a879fce3ef7a59f7b68","BannerIds":["IT.RS0100a.0202.0100- a102"]},{"SuggestedTitle":"Autentico.Locale.Buono.","SuggestedDescription":"Ti proponiamo un’esperienza culinaria unica in una location d’eccezione.Riscopri il sapore dell’autenticità. Vieni a trovarci. ","Id":"ee57a7ab8b1a447f8149e94fbf7c4619","BannerIds":["IT.RS0100a.0303.0100-a203"]}]}'))}),dev.fakeGeocodeAddress&&(i.getSeo=function(){return Promise.resolve(JSON.parse('"anima-cozze"'))}),i}return __extends(t,e),t}(AutoServiceAgent),InvoiceServiceAgent=function(e){function t(t){var i=e.call(this,t,{name:"prepareForCampaign",method:"POST",uri:function(e){return i.formatUri("/api/Invoice/PrepareForCampaign",[e[0]])},body:function(e){return e[1]}},{name:"prepareForCampaignGroup",method:"POST",uri:function(e){return i.formatUri("/api/Invoice/PrepareForCampaignGroup",[e[0]])},body:function(e){return e[1]}},{name:"get",method:"GET",uri:"/api/Invoice"})||this;return i}return __extends(t,e),t}(AutoServiceAgent),SemanticWebServiceAgent=function(e){function t(t){var i=e.call(this,t,{name:"searchLocation",uri:function(e){return i.formatUri("/api/SemanticWeb/SearchLocation",e)}},{name:"search",uri:function(e){return i.formatUri("/api/SemanticWeb/Search",e)}},{name:"getDetails",uri:function(e){return i.formatUri("/api/SemanticWeb/GetDetails",[e[0],e[1]],{latitude:e[2].latitude,longitude:e[2].longitude,isBulkUpload:e[3],proposalBulkId:e[4]})}},{name:"getBulkDetails",uri:function(e){return i.formatUri("/api/SemanticWeb/GetBulkDetails",[e[0],e[1]])}},{name:"GeocodeAddress",uri:function(e){return i.formatUri("/api/SemanticWeb/GeocodeAddress",e)}},{name:"Geocode",uri:function(e){return i.formatUri("/api/SemanticWeb/Geocode",[e[0],e[1],e[2]])}},{name:"GeocodeLocationFile",method:"POST",uri:"/api/SemanticWeb/Geocode/File",body:function(e){return e[0]}},{name:"getInsightRadius",uri:function(e){return i.formatUri("/api/SemanticWeb/GetDetails",[e[0],e[1]],{latitude:e[2].latitude,longitude:e[2].longitude,isBulkUpload:e[3],proposalBulkId:e[4]})}})||this;return dev.fakeSemanticWeb&&(i.getDetails=function(){return Promise.resolve(JSON.parse('{"Url":"https://maps.google.com/?cid=9154458214224756504","Website":"http://illorenzaccio.wordpress.com/","PhoneNumber":"030 220457","PotentialUsers":50547,"MaleStats":26819.957859411254,"MaleStatsPercentage":0.53,"MaleStatsAverageAge":29.0,"FemaleStats":23727.466440728695,"FemaleStatsPercentage":0.47,"FemaleStatsAverageAge":39.0,"BugdetMinValue":10,"BugdetMaxValue":60,"PublicOfficesNumber":43,"PrivatesNumber":13,"PublicTransportNumber":14,"Radius":3000,"Tracing":null,"Population":610,"Address":"Via Cipro, 78, 25124 Brescia BS","Geometry":{"location":{"lat":45.523879499999993,"lng":10.2103229}},"ID":"ChIJxXJsdHZ2gUcRGP8FUj4rC38","Name":"Il Lorenzaccio","Categories":[{"Category":"RS0100","Description":"Ristorante","Score":100.0,"Competitors":20},{"Category":"RS0101","Description":"Ristorante di carne","Score":0.0,"Competitors":20},{"Category":"RS0102","Description":"Ristorante di pesce","Score":0.0,"Competitors":17},{"Category":"RS0103","Description":"Trattoria","Score":0.0,"Competitors":20}]}'))}),dev.fakeGeocodeAddress&&(i.GeocodeAddress=function(){return Promise.resolve(JSON.parse('{ "PlaceId": "ChIJV6OfdBXBhkcRvXTuKvwoTZo", "StreetNumber": "41", "Address": "Corso Sempione", "City": "Milano","Province": "MI", "Region": "Lombardia","Country": "Italy", "PostalCode": "20145", "Location":{"lat": 45.4811075,"lng": 9.1644886}, "FormattedAddress": "Corso Sempione, 41, 20145 Milano MI, Italy"}'))}),dev.fakeInsight&&(i.getInsightRadius=function(){return Promise.resolve(JSON.parse('{"Insights":[{"Radius":500,"PotentialUsers":500,"MaleStats":300,"FemaleStats":200},{"Radius":1000,"PotentialUsers":1000,"MaleStats":0,"FemaleStats":1000},{"Radius":1500,"PotentialUsers":1500,"MaleStats":500,"FemaleStats":1000},{"Radius":2000,"PotentialUsers":2000,"MaleStats":1500,"FemaleStats":500},{"Radius":2500,"PotentialUsers":2500,"MaleStats":1500,"FemaleStats":1000},{"Radius":3000,"PotentialUsers":48000,"MaleStats":24819.957859411254,"FemaleStats":23728.466440728695},{"Radius":3500,"PotentialUsers":50500,"MaleStats":26819.957859411254,"FemaleStats":23727.466440728695},{"Radius":4000,"PotentialUsers":85000,"MaleStats":40819.957859411254,"FemaleStats":40727.466440728695},{"Radius":4500,"PotentialUsers":95000,"MaleStats":28819.957859411254,"FemaleStats":43727.466440728695},{"Radius":5000,"PotentialUsers":150000,"MaleStats":126819.957859411254,"FemaleStats":23727.466440728695}]}'))}),i}return __extends(t,e),t}(AutoServiceAgent),GoogleServiceAgent=function(){function e(){}return e.prototype.geocode=function(e){return new Promise(function(t,i){var n=new google.maps.Geocoder,s="string"==typeof e?{address:e}:{location:e};n.geocode(s,function(e,n){e.length>0?t(e[0]):i(n)})})},e}(),SecurityServiceAgent=function(e){function t(t){return e.call(this,t,{name:"signupAgency",method:"POST",uri:function(e){return"/api/security/agency"},body:function(e){return e[0]}})||this}return __extends(t,e),t}(AutoServiceAgent),AgencyServiceAgent=function(e){function t(t){var i=e.call(this,t,{name:"get",method:"GET",uri:"/api/agency"},{name:"getAgency",method:"GET",uri:"/api/agency/getAgency"},{name:"creditBalance",method:"GET",uri:"/api/agency/creditBalance"},{name:"askCredit",method:"POST",uri:"/api/agency/askCredit",body:function(e){return e[0]}},{name:"updateAgency",method:"PUT",uri:"/api/agency/UpdateAgency",body:function(e){return e[0]}},{name:"getTransactions",method:"GET",uri:function(e){return i.formatUri("/api/agency/transactions",void 0,{$top:e[0],$skip:e[1]})}})||this;return i}return __extends(t,e),t}(AutoServiceAgent),ReportServiceAgent=function(e){function t(t){var i=e.call(this,t,{name:"groupsSummary",method:"GET",uri:"/api/report/groupssummary"},{name:"groups",method:"GET",uri:function(e){return i.formatUri("/api/report/groups",void 0,{status:e[0],$top:e[1],$skip:e[2]})}},{name:"groupsCount",method:"GET",uri:function(e){return i.formatUri("/api/report/groups",void 0,{$select:"Id",status:e[0]})},responseCallback:function(e){return e.length}},{name:"getCampaignById",method:"GET",uri:function(e){return i.formatUri("/api/report/"+e[0],void 0,void 0)}},{name:"getCampaignGroupById",method:"GET",uri:function(e){return i.formatUri("/api/report/group/"+e[0],void 0,void 0)}},{name:"getCampaignDetailsById",method:"GET",uri:function(e){return i.formatUri("/api/report/"+e[0]+"/details",void 0,void 0)}},{name:"getCampaignDetailsByGroupId",method:"GET",uri:function(e){return i.formatUri("/api/report/group/"+e[0]+"/details",void 0,void 0)}},{name:"campaigns",method:"GET",uri:function(e){return i.formatUri("/api/report",void 0,{status:e[0],$top:e[1],$skip:e[2]})}},{name:"getCampaignsModeration",method:"GET",uri:"/api/report/moderation"},{name:"GetReportPowerBI",method:"GET",uri:function(e){return i.formatUri("/api/report/group/"+e[0]+"/powerbi",void 0,void 0)}})||this;return i}return __extends(t,e),t}(AutoServiceAgent),UserSession=function(){function e(){this.pdvs=[],this.agencyInfo=new AgencyInfo,this.manualData=new ManualData,this.flow3=new Flow3,this.bulkData=new BulkData,this.tailoredCustomContents=new Map,this.gender=GenderType.BOTH,this.workDays=2}return Object.defineProperty(e.prototype,"formattedBalance",{get:function(){return this.agencyInfo.balance.toPriceFormat()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"originalBusinessName",{get:function(){return this.pdvs.length>0?this.pdvs[0].detail.Name:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"productDescription",{get:function(){return this._productDescription},set:function(e){this._productDescription=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"discount",{get:function(){return this._discount},set:function(e){this._discount=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showPrice",{get:function(){return!this.agencyInfo.agency.IsAgencySales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalPotentialUsers",{get:function(){return this.pdvs.Sum(function(e){return e.detail.PotentialUsers})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalUniqueUsers",{get:function(){return this.pdvs.Sum(function(e){return e.selectedProduct&&e.selectedProduct.item.Value})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalPrice",{get:function(){var e=this.pdvs.Sum(function(e){return e.selectedProduct&&e.selectedProduct.item.Price});return this.tailored&&(e+=50),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalVatPrice",{get:function(){return 1.22*this.totalPrice},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"formattedTotalPrice",{get:function(){return this.totalPrice.toPriceFormat()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"searchRow2Description",{get:function(){var e=this.selectedCopyItem&&this.selectedCopyItem.SuggestedRow2||"";return e&&(e=e.replace("[prezzo]",this.discount).replace("[sconto]",this.discount),e=e.replace("[il tuo prodotto qui]",this.productDescription).replace("[il tuo prodotto qui ]",this.productDescription)),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"getCustomName",{get:function(){return this.originalBusinessName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"getinsightRadiusValues",{get:function(){return this.insightRadiusValues},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.pdvs=[],this.manualData.isSet=!1,this.flow3.address=void 0,this.flow3.radius=void 0},e.prototype.removePdv=function(e){this.pdvs.Remove(e);for(var t=0;t<this.pdvs.length;t++)this.pdvs[t].number=t+1},e.prototype.getPdvById=function(e){var t=this.pdvs.FirstOrDefault(function(t){return t.id==e});return null===t?void 0:t},e.prototype.addPdv=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return[4,this.addPdvAsync(e.Name,e.Address,e.Geometry.location,e.ID)];case 1:return t=i.sent(),1===this.pdvs.length&&(this.businessName=e.Name),this.pdvs.push(t),[2,t]}})})},e.prototype.addBulkPdv=function(e,t,i,n,s,r,o,a){return __awaiter(this,void 0,void 0,function(){var c,u;return __generator(this,function(d){switch(d.label){case 0:return c=void 0!==o?o:i.PlaceId,[4,this.addPdvAsync(e,i.FormattedAddress,i.Location,c,a)];case 1:return u=d.sent(),u.detail.Name=e,u.detail.Address=i.FormattedAddress,u.geocodeAddressPDV=t,u.geocodeAddressCDE=i,u.bulkLandingUrl=n||"",u.bulkTrackingPixel=s||"",u.level=r||1,u.phoneNumber="",this.pdvs.push(u),[2,u]}})})},e.prototype.addPdvAsync=function(e,t,i,n,s){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(r){switch(r.label){case 0:return e=new Pdv(this),e.number=this.pdvs.length+1,e.address=t,e.originalLocation=i,e.locationAddress=t,e.location=i,e.id=(this.pdvs.Select(function(e){return parseInt(e.id)}).Max()+1).toString(),e.googleId=n,e.firstNumberInsert=e.number,[4,e.load(s)];case 1:return r.sent(),[2,e]}})})},e.prototype.duplicatePdv=function(e,t){return __awaiter(this,void 0,void 0,function(){var i,n;return __generator(this,function(s){switch(s.label){case 0:return(i=this.getPdvById(e))?(n=new Pdv(this),n.number=this.pdvs.length+1,n.address=i.address,n.locationAddress=i.address,n.originalLocation=i.originalLocation,n.location=i.originalLocation,n.googleId=i.googleId,n.id=t.id,[4,n.load()]):[2];case 1:return s.sent(),[4,n.loadProducts(!0)];case 2:return s.sent(),this.pdvs.push(n),[2,n]}})})},e.prototype.getTailoredCustomContentsUris=function(){if(this.tailored){var e=[];return this.tailoredCustomContents.forEach(function(t){return e.push(t)}),e}},e.prototype.evaluateBulk=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){return e=ServiceAgentFactory.get(CampaignServiceAgent),[2,e.evaluateBulk()]})})},e.prototype.moreProductsBulk=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return t=ServiceAgentFactory.get(CampaignServiceAgent),[4,t.moreProductsBulk(e)];case 1:return[2,i.sent()]}})})},e.prototype.InsightRadiusAsync=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return t=ServiceAgentFactory.get(SemanticWebServiceAgent),[4,t.getInsightRadius(e)];case 1:return[2,i.sent()]}})})},e}(),Pdv=function(){function e(e){this.session=e,this.manualData=new ManualPdvData,this.products=[]}return Object.defineProperty(e.prototype,"phoneNumber",{get:function(){return this._phoneNumber},set:function(e){this._phoneNumber=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clickToCallCustom",{get:function(){return this._clickToCall},set:function(e){this._clickToCall=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clickToMapCustom",{get:function(){return this._clickToMap},set:function(e){this._clickToMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapItem",{get:function(){return{id:this.id,lat:this.location.lat,lng:this.location.lng,address:this.address,radius:this.detail.Radius,phoneNumber:this.phoneNumber,title:this.session.bulkData?this.detail.Name:this.session.originalBusinessName,insights:{data:{PotentialUsers:Math.round(this.detail.PotentialUsers).toString(),MaleStats:Math.round(this.detail.MaleStats).toString(),FemaleStats:Math.round(this.detail.FemaleStats).toString(),MaleStatsPercentage:100*this.detail.MaleStatsPercentage,FemaleStatsPercentage:100*this.detail.FemaleStatsPercentage,PublicOfficesNumber:this.detail.PublicOfficesNumber,PrivatesNumber:this.detail.PrivatesNumber,PublicTransportNumber:this.detail.PublicTransportNumber,Competitors:this.categoryDetail?this.categoryDetail.Competitors:0,Ranking:this.evaluation&&null!=this.evaluation.Ranking?this.evaluation.Ranking:[3,6,7],Cluster:this.detail.Cluster,DensityPotentialUsers:Math.round(this.detail.PotentialUsers/(3.14*Math.pow(this.detail.Radius/1e3,2))),DensityPotentialUsersNumber:this.DensityPotentialUsersNumber}},image:this.session.businessCategoryId&&"No cat"!=this.session.businessCategoryId?"/assets/img/categories/"+this.session.businessCategoryId+".jpg":"/assets/img/logo-admove.png",budget:{id:this.selectedProduct?this.selectedProduct.item.Id:"-",value:this.selectedProduct?this.selectedProduct.item.Price.toLocaleString():"-",reach:this.selectedProduct?this.selectedProduct.item.Value:0,target:this.selectedProduct?this.selectedProduct.reachWording:"-"}}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clickToCall",{get:function(){return this.clickToCallCustom},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clickToMap",{get:function(){return this.clickToMapCustom},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"uriClickToMap",{get:function(){return void 0==this.clickToMap||null==this.clickToMap?"":this.clickToMap==this.address?"https://www.google.it/maps/?q={0}+{1}".uriFormat(this.session.originalBusinessName,this.clickToMap):"https://www.google.it/maps/?q={0}".uriFormat(this.clickToMap)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"formattedPrices",{get:function(){return this.selectedProduct?this.selectedProduct.item.Price.toPriceFormat():["-","-"]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"formattedMaleStats",{get:function(){return Math.round(this.detail.MaleStats).toString()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"formattedFemaleStats",{get:function(){return Math.round(this.detail.FemaleStats).toString()},enumerable:!0,configurable:!0}),e.prototype.getProductsGrouped=function(e,t){return void 0===t&&(t=GenderType.BOTH),this.products.Where(function(e){return e.item.GenderTargets==t}).map(function(e,t){return{product:e,index:t}}).GroupBy(function(t){return Math.floor(t.index/e)}).map(function(e){return e.map(function(e){return e.product})})},e.prototype.getCustomBannerUris=function(){return this.manualData.isSet||this.session.manualData.isSet?[this.getBannerUri(BannerSize.Format1200x628),this.getBannerUri(BannerSize.Format640x1024),this.getBannerUri(BannerSize.Format2020x1320),this.getBannerUri(BannerSize.Format300x250),this.getBannerUri(BannerSize.Format320x480),this.getBannerUri(BannerSize.Format320x50),this.getBannerUri(BannerSize.Format728x90)]:[]},e.prototype.getBannerUri=function(e,t){void 0===t&&(t=void 0);var i="/assets/img/placeholders/"+BannerSize[e]+".jpg";return this.session.manualData.isSet?this.session.manualData.customBanners.get(e)||i:this.session.selectedBannerId?"{0}/api/Banner/Preview/{1}/{2}/{3}/{4}/{5}/{6}/{7}".uriFormat(baseUrl,t||this.session.selectedBannerId,e,this.session.businessName&&this.session.businessName.length>0?this.session.businessName:"[la tua insegna qui]",this.clickToMap,this.clickToCall,this.session.discount&&this.session.discount.length>0?parseFloat(this.session.discount).toLocaleString():"[XX]",this.session.productDescription&&this.session.productDescription.length>0?this.session.productDescription:"[il tuo prodotto qui]"):i},e.prototype.load=function(e){return __awaiter(this,void 0,void 0,function(){var t,i,n,s,r,o,a,c=this;return __generator(this,function(u){switch(u.label){case 0:return e?(this.detail=e,[3,5]):[3,1];case 1:return t=ServiceAgentFactory.get(SemanticWebServiceAgent),i=this,[4,t.getDetails(this.googleId,this.session.businessName,{latitude:this.location.lat,longitude:this.location.lng})];case 2:return i.detail=u.sent(),n=this,[4,t.GeocodeAddress(this.locationAddress)];case 3:return n.geocodeAddressCDE=u.sent(),s=this,[4,t.GeocodeAddress(this.address)];case 4:s.geocodeAddressPDV=u.sent(),u.label=5;case 5:return this.session.businessCategoryId?(r=this.detail.Categories.FirstOrDefault(function(e){return e.Category.replace("00","")==c.session.businessCategoryId}),this.categoryDetail=null!==r?r:void 0):(this.session.isFlow2||this.session.flow3.address||e)&&(this.session.businessCategoryId=this.detail.Categories[0].Category.replace("00",""),this.categoryDetail=this.detail.Categories[0]),this.phoneNumber=this.detail.PhoneNumber?this.detail.PhoneNumber.replace(/\D/g,""):null,this.clickToMapCustom=this.address,this.clickToCallCustom=null,o=this,0!=this.session.pdvs.length?[3,7]:[4,ServiceAgentFactory.get(CampaignServiceAgent).getSeo(this.session.businessName)];case 6:return a=u.sent(),[3,8];case 7:a=null!=this.session.pdvs[0].seo.match(/\d+/g)?this.session.pdvs[0].seo.replace(/\d+/g,(+this.session.pdvs[0].seo.match(/\d+/)[0]+this.session.pdvs.length).toString()):this.session.pdvs[0].seo+"-"+this.session.pdvs.length,
u.label=8;case 8:return o.seo=a,[2]}})})},e.prototype.reset=function(){this.locationAddress=this.address,this.location=this.originalLocation},e.prototype.loadProducts=function(e){return void 0===e&&(e=!1),__awaiter(this,void 0,void 0,function(){var t,i,n,s,r=this;return __generator(this,function(o){switch(o.label){case 0:return this.evaluation&&!e?[3,2]:(t=this,[4,this.evaluate()]);case 1:t.evaluation=o.sent(),o.label=2;case 2:if(i=this.evaluation.Proposals.FirstOrDefault(function(e){return e.AdvertisementType.toString()===AdvertisementType[r.session.advertisementType]}),null===i)throw new Error("Cannot find proposal for "+AdvertisementType[this.session.advertisementType]);return this.proposal=i,n=ServiceAgentFactory.get(CampaignServiceAgent),[4,n.moreProducts(this.proposal.Id)];case 3:return s=o.sent(),this.products=s.Products.Select(function(e){return new Product(r,e)}),this.selectedProduct=this.products[0],[2]}})})},Object.defineProperty(e.prototype,"reachWording",{get:function(){var e="";return e=this.session.advertisementType==AdvertisementType.DISPLAYCLICK||this.session.advertisementType==AdvertisementType.SEARCHGOOGLE?"Click":this.session.advertisementType==AdvertisementType.FLYER?"Impressions":"Utenti Unici",e+=this.session.gender==GenderType.FEMALE?" Donna":this.session.gender==GenderType.MALE?" Uomo":""},enumerable:!0,configurable:!0}),e.prototype.evaluate=function(){var e=ServiceAgentFactory.get(CampaignServiceAgent);return e.evaluate({Evaluation:{BusinessName:this.session.originalBusinessName,BusinessCategoryId:this.session.businessCategoryId,FreeText:this.session.originalBusinessName,StartDate:new Date,Budget:0,Website:"",Proposal:this.session.objective,FacebookPage:"",Locations:[{Latitude:this.location.lat,Longitude:this.location.lng}],Top:10},DiagnosticData:!1})},e}(),BulkData=function(){function e(){this.orderBy="Level"}return Object.defineProperty(e.prototype,"enhancementBudget",{get:function(){return this.Landings.length<=100?0:this.Landings.length-100},enumerable:!0,configurable:!0}),e}(),ManualData=function(){function e(){this.isSet=!1,this.customBanners=new Map}return e}(),ManualPdvData=function(){function e(){this.isSet=!1,this.customBanners=new Map}return e}(),Product=function(){function e(e,t){this.pdv=e,this.item=t}return Object.defineProperty(e.prototype,"isSelected",{get:function(){return this.pdv.selectedProduct===this},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showPrice",{get:function(){return this.pdv.session.showPrice},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"formattedPrice",{get:function(){return this.item.Price.toPriceFormat()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reachWording",{get:function(){return this.pdv.reachWording},enumerable:!0,configurable:!0}),e}(),AgencyInfo=function(){function e(){}return Object.defineProperty(e.prototype,"onlinePayment",{get:function(){return"BANCASELLA-AGENCY"===this.agency.PaymentMethodId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"postPayment",{get:function(){return"POSTPAID"===this.agency.PaymentMethodId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"prePayment",{get:function(){return"PREPAID"===this.agency.PaymentMethodId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canAskCredit",{get:function(){return this.prePayment},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentUserIsAdmin",{get:function(){return this.agency&&this.agency.IsAdmin},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAtClosure",{get:function(){return"ATCLOSURE"===this.agency.AgencyPayMode},enumerable:!0,configurable:!0}),e.prototype.load=function(){return __awaiter(this,void 0,void 0,function(){var e,t,i;return __generator(this,function(n){switch(n.label){case 0:return e=ServiceAgentFactory.get(AgencyServiceAgent),[4,e.get()];case 1:if(t=n.sent(),0==t.length)throw new Error("No agency available");return this.agency=t[0],i=this,[4,e.creditBalance()];case 2:return i.balance=n.sent(),[2]}})})},e}(),Flow3=function(){function e(){}return e}(),NavigationService=function(){function e(e){this.baseUrl=e,this._pages={},this._journal=[],this._anonymousKeys=["index","registrati","errore"],this._authenticatedKeys=["dashboard","account","pagamentocompletato","pagamentoerrore","sceltaflusso"],this._userSession=new UserSession,this._insightsPane=new Sidebar,this._navigo=new Navigo(null,!0),this._navigo.on("*",this.navigoOn.bind(this)).resolve(),$(document).on("click",".btn-back:not([data-navigo])",function(){return history.back()}),$(document).on("click","#menu-left a",function(){return $("#open-menu").click()}),this.setHomeButton(),this.setLoginButton()}return Object.defineProperty(e.prototype,"currentPage",{get:function(){return this._currentPage?this._currentPage.page:void 0},enumerable:!0,configurable:!0}),e.prototype.setLoginButton=function(){var e=this,t=ServiceAgentFactory.context.accessTokenExpired;$("[data-page-loginout]").text(t?"Login":"Logout").attr("href",t?getLoginUrl():"#").click(function(t){ServiceAgentFactory.context.accessTokenExpired||(t.preventDefault(),setTimeout(e.navigateToStart.bind(e),10)),ServiceAgentFactory.context.accessToken=void 0})},e.prototype.setHomeButton=function(){var e=ServiceAgentFactory.context.accessTokenExpired;$("[data-page-home]").attr("href",e?"/":"/#home-flusso-3")},e.prototype.checkAadResponse=function(e){var t=this,i=e.url.parseQuery();if(i.error)return console.error("Error from Azure AAD",i.error),function(){return t.navigateToStart()};if(i.id_token){var n=i.id_token||"";ServiceAgentFactory.context.accessToken=n,e.url="";var s=i.state||"home-flusso-3";return function(){return t._navigo.navigate(s)}}},e.prototype.navigateToStart=function(){document.location.href="/"},e.prototype.checkBackNavigation=function(e){var t=this._journal.lastIndexOf(e);if(t<0)return!1;this._currentPage&&this._journal.lastIndexOf(this._currentPage.key)==t+1&&t++;for(var i=t;i<this._journal.length;i++){var n=this._journal[i],s=this._pages[n];s&&(s.html.find("*").off(),s.html.remove()),delete this._pages[n],this._journal.splice(i,1),i--}return!1},e.prototype.navigoOn=function(e,t){var i,n=this,s=this._navigo.lastRouteResolved();i=this.checkAadResponse(s);var r=s.url.toLowerCase().replace(/^\/+/,"").replace(/[#_-]+/g,"");0!==r.length&&0!==r.indexOf("http")||(r="index");var o=this._anonymousKeys.indexOf(r)>=0,a=this._authenticatedKeys.indexOf(r)>=0;if(a){if(ServiceAgentFactory.context.accessTokenExpired)return void(document.location.href=getLoginUrl(r))}else if(!(o||this._currentPage&&!ServiceAgentFactory.context.accessTokenExpired))return void this.navigateToStart();if(!this.checkBackNavigation(r)){var c=this._pages[r];if(!c){var u=window[r];if(!u)throw Error("Cannot find class "+r);c={page:new u,url:s.url.substr(1),key:r},c.page.navigo=this._navigo,c.page.userSession=this._userSession,c.page.sidebar=this._insightsPane,this._pages[r]=c,this._journal.push(r)}if(c.html)this.changePage(c),i&&i();else{var d="?"+Math.round((new Date).getTime()/1e3).toString();$.get(this.baseUrl+c.page.relativeUri+d,function(e,t,s){c.page.html=c.html=$("<div/>").html(e),c.page.pagePlaceholder.append(c.html),n._navigo.updatePageLinks(),n.changePage(c,!0),i&&i()},"html")}}},e.prototype.changePage=function(e,t){void 0===t&&(t=!1),this._currentPage&&(this._currentPage.page.onNavigatedFrom(),this._currentPage.html.hide()),this._currentPage=e,e.html.show(),window.scroll(0,0),t===!0&&e.page.onLoad(),e.page.onNavigatedTo()},e}(),Page=function(){function e(e){this.relativeUri=e,Handlebars.registerHelper("for",function(e,t,i,n){for(var s="",r=e;r<t;r+=i)s+=n.fn(r);return s}),Handlebars.registerHelper("formatDate",function(e,t){return moment?moment(e).format(t):e})}return Object.defineProperty(e.prototype,"pagePlaceholder",{get:function(){return $("[data-page-html]")},enumerable:!0,configurable:!0}),e.prototype.onLoad=function(){var e=this;this.html.find("input,textarea").characterCounter().trigger("change"),setTimeout(function(){e.html.find("input,textarea").trigger("change")},200)},e.prototype.onNavigatedTo=function(){this.setNavigationLinks()},e.prototype.onNavigatedFrom=function(){},e.prototype.setNavigationLinks=function(){$("[data-security-isadmin]").toggle(this.userSession.agencyInfo.currentUserIsAdmin)},e.prototype.runAsync=function(e,t,i,n){return void 0===t&&(t=RunPolicy.AskForRetry),void 0===i&&(i=!0),void 0===n&&(n=!1),__awaiter(this,void 0,void 0,function(){var s,r,o,a,c;return __generator(this,function(u){switch(u.label){case 0:u.trys.push([0,5,,9]),r=!1,o=$("<div class='overlay'></div>"),u.label=1;case 1:return u.trys.push([1,,3,4]),$(document.body).append(o),delay(500).then(function(){if(o.remove(),!r&&i){var e=n?{complex:!0,strings:["uno","due","tre","stella!"]}:null;s=CMS.preloader(e)}}),[4,e()];case 2:return u.sent(),[3,4];case 3:return o.remove(),r=!0,s&&s.close(),[7];case 4:return[3,9];case 5:switch(a=u.sent(),console.error(a),c=void 0,t){case RunPolicy.RaiseError:throw a;case RunPolicy.Try:c="OK";break;case RunPolicy.AskForRetry:c="Riprova";break;default:throw Error("Unknown policy")}return[4,this.showAlert("Errore",a.message,c)];case 6:return u.sent(),t!=RunPolicy.AskForRetry?[3,8]:[4,this.runAsync(e,t)];case 7:u.sent(),u.label=8;case 8:return[3,9];case 9:return[2]}})})},e.prototype.showAlert=function(e,t,i){return void 0===i&&(i="OK"),new Promise(function(n,s){var r;r=CMS.showAlert(e,t,[{id:"alertDialog",label:i,icon:"glyphicon glyphicon-ok-circle",cssClass:"btn-primary",action:function(){r.close(),n()}}],BootstrapDialog.TYPE_DANGER,BootstrapDialog.SIZE_LARGE)})},e.prototype.getTemplateScript=function(e,t){var i=$("#"+e),n=i.html(),s=Handlebars.compile(n),r=s(t||this);return r},e.prototype.renderTemplateScript=function(e,t){var i=this.html.find("#"+e),n=this.getTemplateScript(e,t),s=e+"Out",r=this.html.find("#"+s);return 0===r.length&&(r=$("<div/>").attr("id",s),r.insertBefore(i)),r.html(n)},Object.defineProperty(e.prototype,"reachWording",{get:function(){var e="";return e=this.userSession.advertisementType==AdvertisementType.DISPLAYCLICK||this.userSession.advertisementType==AdvertisementType.SEARCHGOOGLE?"Click":this.userSession.advertisementType==AdvertisementType.FLYER?"Impressions":"Utenti Unici"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"disableHolidayWeekendDays",{get:function(){var e=[],t=new Date,i=7-t.getDay();return e.push(t.addDays(i)),e.push(t.addDays(--i)),e.push(this.easterSunday(t.getFullYear()).addDays(1)),e.push(new Date(t.getFullYear(),0,1)),e.push(new Date(t.getFullYear(),0,6)),e.push(new Date(t.getFullYear(),3,25)),e.push(new Date(t.getFullYear(),4,1)),e.push(new Date(t.getFullYear(),5,2)),e.push(new Date(t.getFullYear(),7,15)),e.push(new Date(t.getFullYear(),10,1)),e.push(new Date(t.getFullYear(),11,7)),e.push(new Date(t.getFullYear(),11,8)),e.push(new Date(t.getFullYear(),11,24)),e.push(new Date(t.getFullYear(),11,25)),e.push(new Date(t.getFullYear(),11,26)),e.push(new Date(t.getFullYear(),11,31)),e},enumerable:!0,configurable:!0}),e.prototype.easterSunday=function(e){var t=e%19,i=e/100,n=(Math.floor(i)-Math.floor(i/4)-Math.floor((8*i+13)/25)+19*t+15)%30,s=n-Math.floor(n/28)*(1-Math.floor(n/28)*Math.floor(29/(n+1))*Math.floor((21-t)/11)),r=s-(e+Math.floor(e/4)+s+2-Math.floor(i)+Math.floor(i/4))%7+28,o=3;return r>31&&(o++,r-=31),new Date(e,o-1,r)},e}(),RunPolicy;!function(e){e[e.Try=0]="Try",e[e.AskForRetry=1]="AskForRetry",e[e.RaiseError=2]="RaiseError"}(RunPolicy||(RunPolicy={}));var Sidebar=function(){function e(){this.carouselPdiTemplate=$("#owl-dashboard .row.item:first").removeClass("hide").remove()}return e.prototype.changeMode=function(e){switch(this.editAddress.hide(),this.owlDashboard.hide(),this.insights.hide(),this.sidebarButton.hide(),e){case SidebarMode.Full:this.editAddress.show(),this.owlDashboard.show(),this.sidebarButton.show(),this.insights.show();break;case SidebarMode.ReadOnly:this.sidebarButton.show(),this.owlDashboard.show(),this.insights.show();break;case SidebarMode.Hidden:this.sidebarButton.show(),this.isOpen&&this.toggle();break;case SidebarMode.Unavailable:this.isOpen&&this.toggle()}},e.prototype.toggle=function(){$("#open-sidebar").click()},Object.defineProperty(e.prototype,"isOpen",{get:function(){return $("#sidebar-dashboard").hasClass("open")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"insights",{get:function(){return $("#insights")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sidebarButton",{get:function(){return $(".sidebar-button")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"editAddress",{get:function(){return $("#editAddress")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"locationAddress",{get:function(){return $("#locationAddress")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"owlDashboard",{get:function(){return $("#owl-dashboard")},enumerable:!0,configurable:!0}),e}(),SidebarMode;!function(e){e[e.Unavailable=0]="Unavailable",e[e.Hidden=1]="Hidden",e[e.ReadOnly=2]="ReadOnly",e[e.Full=3]="Full"}(SidebarMode||(SidebarMode={}));var index=function(e){function t(){return e.call(this,"index.html")||this}return __extends(t,e),t.prototype.onNavigatedTo=function(){e.prototype.onNavigatedTo.call(this),this.sidebar.changeMode(SidebarMode.Unavailable)},t.prototype.onLoad=function(){e.prototype.onLoad.call(this),$("[data-page-login]").click(function(e){e.preventDefault(),document.location.href=getLoginUrl()})},t}(Page),sceltacategoria=function(e){function t(){return e.call(this,"scelta-categoria.html")||this}return __extends(t,e),t.prototype.onLoad=function(){e.prototype.onLoad.call(this),this.removeDuplicatedFields(),this.html.find("form:first").submit(this.formSubmit.bind(this)),this.html.find("#popup-multi form").submit(this.popupSubmit.bind(this)),this.html.on("click","[data-nocategory]",this.noCategoryClick.bind(this)),this.html.find("[data-agency]").text(this.userSession.agencyInfo.agency.AgencyDescription)},t.prototype.onNavigatedTo=function(){e.prototype.onNavigatedTo.call(this),this.sidebar.changeMode(SidebarMode.Unavailable),this.removeDuplicatedFields()},t.prototype.removeDuplicatedFields=function(){this.userSession.isFlow2===!0?this.html.find("[data-row-flow1]").remove():this.html.find("[data-row-flow2]").remove()},t.prototype.noCategoryClick=function(e){e.preventDefault();var t=this.html.find("[name=address]").val(),i=this.html.find("[name=businessName]").val();this.searchPdv(i,void 0,t)},t.prototype.popupSubmit=function(e){var t=this;e.preventDefault(),this.html.find("#popup-multi").modal("hide");var i=this.html.find(".slogan.selected").data("item");this.runAsync(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.userSession.businessName=i.Name,[4,this.userSession.addPdv(i)];case 1:return e.sent(),this.gotoNextStep(),[2]}})})})},t.prototype.gotoNextStep=function(){this.userSession.objective=EvaluationObjective[$(".selected[data-objective]").data("objective")],this.userSession.objectiveDescription=$(".selected[data-objective] p:first").text(),this.userSession.businessCategoryId||(this.userSession.businessCategoryId="No cat"),this.userSession.isFlow2?this.navigo.navigate("scelta-prodotto"):this.navigo.navigate("prodotto-obiettivo")},t.prototype.searchPdv=function(e,t,i){var n=this;this.userSession.clear(),this.userSession.businessCategoryId=t,this.userSession.businessName=e,this.userSession.searchText=e,this.runAsync(function(){return __awaiter(n,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return e=ServiceAgentFactory.get(SemanticWebServiceAgent),[4,e.searchLocation(i,this.userSession.businessName)];case 1:return t=n.sent(),this.userSession.clear(),t.Results.length>0?t.Results.length>1?(this.renderTemplateScript("slogan-list-template",t.Results),this.html.find(".slogan").each(function(e,i){$(i).data("item",t.Results[e])}),this.html.find(".slogan").first().trigger("click"),this.html.find("#popup-multi").modal("show"),[3,4]):[3,2]:[3,5];case 2:return[4,this.userSession.addPdv(t.Results[0])];case 3:n.sent(),this.gotoNextStep(),n.label=4;case 4:return[3,6];case 5:this.showAlert("Non trovato","Nessuna insegna trovata"),n.label=6;case 6:return[2]}})})})},t.prototype.formSubmit=function(e){e.preventDefault();var t=$(e.target).find("[name=address]").val(),i=$(e.target).find("[name=businessName]").val();if(this.userSession.isFlow2===!1){var n=this._categoriesDictionary[$("#category").val()];if(!n)return void this.html.find("#category").focus();this.searchPdv(i,n,t)}else this.searchPdv(i,void 0,t)},t.prototype.prepareCategoryBloodhound=function(e,t){return t.url+=encodeURIComponent(e)+"?$top=50",t},t.prototype.transformCategoryBloodhound=function(e){var t=this,i={};return this._categoriesDictionary={},e.forEach(function(e){i[e.BusinessCategoryId]=e.BusinessCategoryDescription,t._categoriesDictionary[e.BusinessCategoryDescription]=e.BusinessCategoryId}),i},t.prototype.selectedCategoryBloodhound=function(e,t){console.log(this._categoriesDictionary[t])},t}(Page),prodottoobiettivo=function(e){function t(){return e.call(this,"prodotto-obiettivo.html")||this}return __extends(t,e),t.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this),["PH01"].findIndex(function(e){return t.userSession.businessCategoryId==e})>=0&&this.html.find("[data-type='SEARCHGOOGLE']").hide()},t.prototype.onNavigatedFrom=function(){e.prototype.onNavigatedFrom.call(this),this.userSession.advertisementType=AdvertisementType[$(".selected[data-type]").data("type")],this.userSession.advertisementTypeDescription=$(".selected[data-type] .panel-heading").text(),this.userSession.isFlow2===!1&&(this.userSession.objective=EvaluationObjective[$(".selected[data-objective]").data("objective")],this.userSession.objectiveDescription=$(".selected[data-objective] p:first").text())},t.prototype.onNavigatedTo=function(){e.prototype.onNavigatedTo.call(this),this.sidebar.changeMode(SidebarMode.Unavailable)},t}(Page),map=function(e){function t(){return e.call(this,"map.html")||this}return __extends(t,e),t.prototype.onLoad=function(){e.prototype.onLoad.call(this),this.html.find("[data-business-name]").text(this.userSession.originalBusinessName),$("#add-pdi-form").submit(this.addPdiFormSubmit.bind(this)),this.sidebar.insights.find("form").submit(this.onInsightsForm.bind(this)),this.html.find("#mpopup-multi form").submit(this.popupSubmit.bind(this)),this.html.find("#both").prop("checked",!0);var t=this.html.find(".gender");$.inArray(this.userSession.advertisementType,[0,1,2,5])>=0&&t.removeClass("hide")},t.prototype.onChangeGender=function(e){e.preventDefault();var t=GenderType[e.currentTarget.id.toUpperCase()];this.userSession.gender=t;var i=this._plugin.getSelected().id,n=this.userSession.getPdvById(i);if(n){this.renderTemplateScript("products-template",n.getProductsGrouped(6,this.userSession.gender));var s=this.html.find("#prices .owl-item.active");s.find(".well.selected").length<=0?s.find(".well:first").trigger("click"):console.log(s.find(".well.selected").length)}},t.prototype.onNavigatedTo=function(){e.prototype.onNavigatedTo.call(this),this.sidebar.changeMode(SidebarMode.Full),this.sidebar.isOpen||this.sidebar.toggle()},t.prototype.updateNextButton=function(){this.html.find("[data-navigo]").toggleClass("disabled",0==this.userSession.pdvs.length)},t.prototype.addPdiFormSubmit=function(e){return __awaiter(this,void 0,void 0,function(){var t,i=this;return __generator(this,function(n){return e.preventDefault(),t=$(e.target).find("[name=address]").val(),this.runAsync(function(){return __awaiter(i,void 0,void 0,function(){var e,i,n,s,r,o,a,c,u;return __generator(this,function(d){switch(d.label){case 0:return e=ServiceAgentFactory.get(SemanticWebServiceAgent),[4,e.searchLocation(t,this.userSession.businessName)];case 1:if(i=d.sent(),!(i.Results.length>0))return[3,6];if(!(i.Results.length>1))return[3,2];for(n=this.userSession.pdvs.Select(function(e){return e.address}).Distinct(),s=function(e){r=i.Results.First(function(t){return t.Address==e}),r&&i.Results.Remove(r)},o=0,a=n;o<a.length;o++)c=a[o],s(c);return 0==i.Results.length?(this.showAlert("Spiacenti",'Non siamo riusciti a trovare altri punti di vendita con nome "'+this.userSession.businessName+'" nella citt� di '+t+"."),[2]):(this.renderTemplateScript("mslogan-list-template",i.Results),this.html.find(".slogan").each(function(e,t){$(t).data("item",i.Results[e])}),this.html.find(".slogan").first().trigger("click"),this.html.find("#mpopup-multi").modal("show"),[3,5]);case 2:return[4,this.userSession.addPdv(i.Results[0])];case 3:return u=d.sent(),this.userSession.pdvs.Remove(u),[4,u.loadProducts()];case 4:d.sent(),this.onNewPdv&&this.onNewPdv(u),d.label=5;case 5:return[3,7];case 6:this.showAlert("Esito negativo","Nessun risultato trovato con il nome "+this.userSession.businessName+" all'indirizzo "+t),d.label=7;case 7:return this.updateNextButton(),[2]}})})}),[2]})})},t.prototype.onInsightsForm=function(e){var t=this;e.preventDefault();var i=this._plugin.getSelected().id;this.runAsync(function(){return __awaiter(t,void 0,void 0,function(){var e,t,n,s;return __generator(this,function(r){switch(r.label){case 0:return(e=this.userSession.getPdvById(i))?(t=new GoogleServiceAgent,[4,t.geocode(this.sidebar.locationAddress.val())]):[2];case 1:return n=r.sent(),e.locationAddress=n.formatted_address,this.sidebar.locationAddress.val(e.locationAddress).trigger("change"),e.location={lat:n.geometry.location.lat(),lng:n.geometry.location.lng()},[4,e.load()];case 2:return r.sent(),[4,e.loadProducts(!0)];case 3:return r.sent(),s=e.getProductsGrouped(6,this.userSession.gender),this.renderTemplateScript("products-template",s),this.onUpdatePdv&&this.onUpdatePdv(e.mapItem),[2]}})})})},t.prototype.popupSubmit=function(e){var t=this;e.preventDefault(),this.html.find("#mpopup-multi").modal("hide");var i=this.html.find(".slogan.selected").data("item");this.runAsync(function(){return __awaiter(t,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.userSession.addPdv(i)];case 1:return e=t.sent(),this.userSession.pdvs.Remove(e),[4,e.loadProducts()];case 2:return t.sent(),this.onNewPdv&&this.onNewPdv(e),[2]}})})})},t.prototype.pdiReset=function(e){var t=this,i=this.userSession.getPdvById(e);i&&(i.reset(),this.sidebar.locationAddress.val(i.locationAddress).trigger("change"),this.runAsync(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,i.load()];case 1:return e.sent(),[4,i.loadProducts(!0)];case 2:return e.sent(),this.renderTemplateScript("products-template",i.getProductsGrouped(6,this.userSession.gender)),this.onUpdatePdv&&this.onUpdatePdv(i.mapItem),[2]}})})}))},t.prototype.pdiSelected=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){return t=this.userSession.getPdvById(e),this.selectedPdv=t,t?(this.sidebar.locationAddress.val(t.locationAddress).trigger("change"),this.userSession.gender=GenderType[this.html.find("[name=gender]:checked").val().toUpperCase()],this.renderTemplateScript("products-template",t.getProductsGrouped(6,this.userSession.gender)),[2]):[2]})})},t.prototype.budgetSelected=function(e){this.selectedPdv&&(this.selectedPdv.selectedProduct=this.selectedPdv.products.First(function(t){return t.item.Id===e}))},t.prototype.pdiRemoved=function(e){var t=this.userSession.getPdvById(e);if(t&&this.userSession.removePdv(t),0==this.userSession.pdvs.length)this.navigo.navigate("scelta-categoria");else if(this.onUpdatePdv)for(var i=0,n=this.userSession.pdvs;i<n.length;i++){var s=n[i];this.onUpdatePdv(s.mapItem)}this.updateNextButton()},t.prototype.pdiDuplicated=function(e,t){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(n){return this.runAsync(function(){return __awaiter(i,void 0,void 0,function(){var i;return __generator(this,function(n){switch(n.label){case 0:return[4,this.userSession.duplicatePdv(e,t)];case 1:return i=n.sent(),i&&(this.pdiMoved(i.id,i.location),this.onUpdatePdv&&this.onUpdatePdv(i.mapItem)),[2]}})})}),[2]})})},t.prototype.pdiMoved=function(e,t){return __awaiter(this,void 0,void 0,function(){var i,n,s,r;return __generator(this,function(o){switch(o.label){case 0:if(i=this.userSession.getPdvById(e),!i)return[3,4];i.location=t,i.locationAddress="-",this.sidebar.locationAddress.val(i.locationAddress).trigger("change"),o.label=1;case 1:return o.trys.push([1,3,,4]),n=new GoogleServiceAgent,s=i,[4,n.geocode(t)];case 2:return s.locationAddress=o.sent().formatted_address,this.sidebar.locationAddress.val(i.locationAddress).trigger("change"),[3,4];case 3:return r=o.sent(),console.error(r),[3,4];case 4:return[2]}})})},t.prototype.updatePdi=function(e){var t=this,i=this.userSession.getPdvById(e);i&&this.runAsync(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,i.load()];case 1:return e.sent(),[4,i.loadProducts(!0)];case 2:return e.sent(),this.renderTemplateScript("products-template",i.getProductsGrouped(6,this.userSession.gender)),this.onUpdatePdv&&this.onUpdatePdv(i.mapItem),[2]}})})})},t.prototype.preparePlugin=function(e){var t=this;this._plugin=e,this.runAsync(function(){return __awaiter(t,void 0,void 0,function(){var t,i,n,s,r,n;return __generator(this,function(o){switch(o.label){case 0:t=0,i=this.userSession.pdvs,o.label=1;case 1:return t<i.length?(n=i[t],[4,n.loadProducts(!this.userSession.isFlow2)]):[3,4];case 2:o.sent(),o.label=3;case 3:return t++,[3,1];case 4:for(s=0,r=this.userSession.pdvs;s<r.length;s++)n=r[s],e.actions("add",!1,n.mapItem);return this.sidebar.isOpen||this.sidebar.toggle(),[2]}})})})},t}(Page),riepilogopdv=function(e){function t(){return e.call(this,"riepilogo-pdv.html")||this}return __extends(t,e),t.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this),this.userSession.agencyInfo.askedCredit&&(this.html.find(".anticipo_credito").addClass("complete"),this.html.find(".endprice").removeClass("pricef")),this.html.on("click","[data-ask-credit]",function(e){e.preventDefault(),t.html.find("[data-budget-warning]").popover("hide"),t.html.find("#credit").modal("show")}),this.html.find("#creditsRequest").click(function(e){return __awaiter(t,void 0,void 0,function(){var t,i,n,s=this;return __generator(this,function(r){switch(r.label){case 0:return t=this.userSession.totalVatPrice-this.userSession.agencyInfo.balance,i=ServiceAgentFactory.get(AgencyServiceAgent),n=$(e.target),n.button("loading"),[4,this.runAsync(function(){return __awaiter(s,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,i.askCredit({EuroAmount:t})];case 1:return e.sent(),this.userSession.agencyInfo.askedCredit=!0,[2]}})})},void 0,!1)];case 1:return r.sent(),n.button("reset"),this.html.find("#credit").modal("hide"),this.html.find(".anticipo_credito").addClass("complete"),this.html.find(".endprice").removeClass("pricef"),this.html.find("a[data-navigo]").removeClass("disabled"),[2]}})})}),this.renderPdvTotals(),this.pdvs=this.userSession.pdvs,this.pdvs.forEach(function(e){return e.potentialUsersString=e.detail.PotentialUsers.toLocaleString()}),this.pdvs.forEach(function(e){return e.formattedMaleStatsString=(+e.formattedMaleStats).toLocaleString()}),this.pdvs.forEach(function(e){return e.formattedFemaleStatsString=(+e.formattedFemaleStats).toLocaleString()}),this.pdvs.forEach(function(e){return e.showCompetitorsRanking=void 0!=e.session.businessCategoryId&&"No cat"!=e.session.businessCategoryId}),this.pdvs.forEach(function(e){return e.competitorsRanking=e.mapItem.insights.data.Competitors<=e.mapItem.insights.data.Ranking[0]?"< "+e.mapItem.insights.data.Ranking[0]:e.mapItem.insights.data.Competitors>e.mapItem.insights.data.Ranking[0]+1&&e.mapItem.insights.data.Competitors<=e.mapItem.insights.data.Ranking[1]?e.mapItem.insights.data.Ranking[0]+1+" - "+e.mapItem.insights.data.Ranking[1]:"> "+e.mapItem.insights.data.Ranking[2]}),this.renderTemplateScript("pdvs-template",{pdvs:this.pdvs})},t.prototype.onNavigatedTo=function(){e.prototype.onNavigatedTo.call(this),this.sidebar.changeMode(SidebarMode.ReadOnly),this.sidebar.isOpen&&this.sidebar.toggle()},Object.defineProperty(t.prototype,"hasNotEnoughBudget",{get:function(){return(void 0==this.userSession.agencyInfo.askedCredit||0==this.userSession.agencyInfo.askedCredit)&&(this.userSession.agencyInfo.canAskCredit&&this.userSession.agencyInfo.balance<this.userSession.totalVatPrice)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"budgetNeed",{get:function(){return(Math.round(100*(this.userSession.totalVatPrice-this.userSession.agencyInfo.balance))/100).toLocaleString()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"budgetNeedActions",{get:function(){if(!this.budgetNeed)return[];var e=[];return this.userSession.agencyInfo.canAskCredit&&e.push("<a href='#' data-ask-credit>Richiedere un Anticipo Credito</a>"),e.push("Diminuire i budget per PdV"),e.push("Eliminare 1 o più PdV"),e.map(function(e,t){return t+1+" - "+e})},enumerable:!0,configurable:!0}),t.prototype.pdiShowBudget=function(e){var t=this.userSession.getPdvById(e);this.selectedPdv=t,t&&this.renderTemplateScript("rproducts-template",t.getProductsGrouped(6,this.userSession.gender))},t.prototype.budgetSelected=function(e){var t=this;if(this.selectedPdv){this.selectedPdv.selectedProduct=this.selectedPdv.products.First(function(t){return t.item.Id===e});var i=$(this.getTemplateScript("pdvs-template",{pdvs:this.pdvs})),n=i.find("[data-pdi-id]").filter(function(e,i){return $(i).data("pdi-id")==t.selectedPdv.id}).find(".panel-heading");this.html.find("[data-pdi-id='"+this.selectedPdv.id+"'] .panel-heading").empty().append(n.children()),this.renderPdvTotals()}},t.prototype.pdiRemoved=function(e){var t=this.userSession.getPdvById(e);if(t&&this.userSession.removePdv(t),0==this.userSession.pdvs.length)this.navigo.navigate("scelta-categoria");else{if(this.onUpdatePdv)for(var i=0,n=this.userSession.pdvs;i<n.length;i++){var s=n[i];this.onUpdatePdv(s.mapItem)}this.renderPdvTotals()}},t.prototype.preparePlugin=function(e){for(var t=0,i=this.userSession.pdvs;t<i.length;t++){var n=i[t],s=__assign({},n.mapItem,{duplicable:!1,editable:!1,resettable:!1,circle:{lat:n.location.lat,lng:n.location.lng}});s.lat=n.originalLocation.lat,s.lng=n.originalLocation.lng,e.actions("add",!1,s)}},t.prototype.renderPdvTotals=function(){this.renderTemplateScript("pdvTotals-template"),this.html.find("a[data-navigo]").toggleClass("disabled",this.hasNotEnoughBudget&&this.userSession.pdvs.length>0)},t}(Page),selezionascenari=function(e){function t(){return e.call(this,"seleziona-scenari.html")||this}return __extends(t,e),t.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this),this.userSession.objective!=EvaluationObjective.AnotherTarget&&this.userSession.businessCategoryId&&"No cat"!=this.userSession.businessCategoryId?this.html.find("[data-creativity-admove-container]").show():(this.html.find("[data-creativity-admove-container]").hide().find(".selected").removeClass("selected"),setTimeout(function(){return t.html.find("[data-creativity=LOADED]").click()},1)),this.html.on("change","input[type=radio]",function(e){var i=e.currentTarget.id;t.userSession.selectedCopyItem=t.copyItems.First(function(e){return e.Id==i}),t.userSession.selectedBannerId=t.userSession.selectedCopyItem.BannerIds[0]}),this.html.find("[data-page-scenario]").click(function(){var e=t.html.find("#scenario .selected[data-id]"),i=e.data("id");t.userSession.workDays=parseInt(e.data("time"));var n=moment().startOf("day");switch(t.userSession.campaignStartDate=n.addWorkdays(t.userSession.workDays).toDate(),i){case 1:t.showToneOfVoice();break;case 2:t.navigo.navigate("personalizza-campagna-creativita");
break;case 3:t.navigo.navigate("campagna-creativita-ad-hoc")}}),this.html.find("[data-page-personalizza]").click(function(e){e.preventDefault(),t.toneOfVoiceModal.modal("hide"),t.navigo.navigate("personalizza-campagna")})},t.prototype.onNavigatedTo=function(){e.prototype.onNavigatedTo.call(this),this.sidebar.changeMode(SidebarMode.Unavailable),this.sidebar.isOpen&&this.sidebar.toggle(),this.userSession.manualData.isSet=!1,this.userSession.manualData.customBanners.clear(),this.userSession.selectedCopyItem=void 0,this.userSession.selectedBannerId=void 0,this.userSession.tailored=!1,this.userSession.productDescription=void 0,this.userSession.discount=void 0,this.userSession.businessName=this.userSession.originalBusinessName},Object.defineProperty(t.prototype,"toneOfVoiceModal",{get:function(){return this.html.find("#tone-of-voice")},enumerable:!0,configurable:!0}),t.prototype.showToneOfVoice=function(){var e=this;this.runAsync(function(){return __awaiter(e,void 0,void 0,function(){var e,t,i,n,s=this;return __generator(this,function(r){switch(r.label){case 0:return e=this.userSession.pdvs[0].selectedProduct,e?[4,ServiceAgentFactory.get(CampaignServiceAgent).moreCopyItems(e.item.Id)]:[2];case 1:return t=r.sent(),this.copyItems=t.CopyItems,i=this.userSession.advertisementType==AdvertisementType.SOCIALFB?3:this.userSession.advertisementType==AdvertisementType.FLYER?6:0,n=t.CopyItems.map(function(e,t){return __assign({},e,{Uri:"{0}/api/Banner/Preview/{1}/{2}/{3}/{4}/{5}/{6}/{7}".uriFormat(baseUrl,e.BannerIds[0],i,"[la tua insegna qui]",s.userSession.pdvs[0].clickToMapCustom,s.userSession.pdvs[0].clickToCallCustom,"[XX]","[il tuo prodotto qui]")})}),this.renderTemplateScript("tone-template",n),this.html.find("input[type=radio]:first").prop("checked",!0).trigger("change"),this.userSession.advertisementType===AdvertisementType.SEARCHGOOGLE?this.navigo.navigate("personalizza-campagna"):this.toneOfVoiceModal.modal("show"),[2]}})})})},t.prototype.getWorkDays=function(e){var t=moment().startOf("day");return moment(t.addWorkdays(e).toDate()).userLocale().format("dddd, D MMMM YYYY")},t}(Page),campagnaBase=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.onLoad=function(t){void 0===t&&(t=!1),e.prototype.onLoad.call(this),this.getPagerTooltips();var i=this.getVisibleBannerIndexes(t),n=function(e,t){return!i.Contains(e)};this.pagerTooltips=this.pagerTooltips.filter(function(e,t){return i.Contains(t)}),this.html.find(".item-preview-device, .item-preview-banner").filter(n).remove(),this.html.find(".switch-preview li").filter(n).remove(),this.html.find("[data-image-logo]").attr("src",this.userSession.pdvs[0].mapItem.image),this.html.find("[data-number-banner]").text(i.length-(this.userSession.advertisementType===AdvertisementType.FLYER?1:2)+" banner")},t.prototype.getPagerTooltips=function(){switch(this.relativeUri){case"bulk-creativita.html":case"bulk-riepilogo.html":this.pagerTooltips=["LANDING PAGE PER SMARTPHONE","LANDING PAGE PER TABLET","FORMATO RETTANGOLO MEDIO","FORMATO INTERSTITIAL","FORMATO LEADERBOARD SMARTPHONE","FORMATO LEADERBOARD TABLET"];break;default:this.pagerTooltips=["FORMATO PUBBLICITARIO FACEBOOK","ANNUNCIO GOOGLE ADS","LANDING PAGE PER SMARTPHONE","LANDING PAGE PER TABLET","FORMATO RETTANGOLO MEDIO","FORMATO INTERSTITIAL","FORMATO LEADERBOARD SMARTPHONE","FORMATO LEADERBOARD TABLET"]}},t.prototype.getVisibleBannerIndexes=function(e){void 0===e&&(e=!1);var t=[0,1,2,3,4,5,6,7];switch(this.userSession.advertisementType){case AdvertisementType.DISPLAYCLICK:case AdvertisementType.DISPLAYUU:t=void 0!=this.userSession.bulkData.Landings?0!=this.userSession.bulkData.Landings.length&&e?t.slice(2,6):t.slice(0,6):t.slice(2,8);break;case AdvertisementType.SEARCHGOOGLE:t=[1,2,3];break;case AdvertisementType.SOCIALFB:t=[0,2,3];break;case AdvertisementType.FLYER:t=e?0==this.userSession.bulkData.Landings.length?[0,3]:[3]:[2,5]}return t},t.prototype.verifyAddress=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return this.semanticServiceAgent=ServiceAgentFactory.get(SemanticWebServiceAgent),[4,this.semanticServiceAgent.GeocodeAddress(e)];case 1:return t=i.sent(),[2,t.FormattedAddress.replace(", Italy","").replace("/","-")]}})})},t.prototype.setClickToCall=function(){var e=this;this.html.find("input[data-link-call]:checkbox").each(function(t,i){var n=$(i),s=n.is(":checked"),r=n.closest(".calltoaction"),o=r.find("input[type=text]");s?e.userSession.pdvs[t].clickToCallCustom=""!==o.val()?o.val():null:e.userSession.pdvs[t].clickToCallCustom=null})},t.prototype.setClickToMap=function(){var e=this;this.html.find("input[data-link-map]:checkbox").each(function(t,i){var n=$(i),s=n.is(":checked"),r=n.closest(".calltoaction"),o=r.find("input[type=text]");s?e.userSession.pdvs[t].clickToMapCustom=o.val():e.userSession.pdvs[t].clickToMapCustom=null})},Object.defineProperty(t.prototype,"minCampaignDate",{get:function(){return moment().addWorkdays(this.userSession.workDays).userLocale().toDate()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxCampaignDate",{get:function(){return moment().userLocale().toDate().addDays(365)},enumerable:!0,configurable:!0}),t.prototype.datePickerSelect=function(e){this.userSession.campaignStartDate=e},t}(Page),personalizzacampagna=function(e){function t(){return e.call(this,"personalizza-campagna.html")||this}return __extends(t,e),t.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this),this.userSession.objective===EvaluationObjective.Branding&&this.html.find("[data-product-description]").remove(),this.userSession.objective!==EvaluationObjective.PromotionDiscount&&this.html.find("[data-discount]").remove(),this.userSession.objective!==EvaluationObjective.PromotionPrice&&this.html.find("[data-price]").remove(),this.html.find("[data-change-graphics]").click(function(e){t.runAsync(function(){return __awaiter(t,void 0,void 0,function(){var e,t,i,n,s=this;return __generator(this,function(r){switch(r.label){case 0:return e=this.selectedPdv,e?[4,ServiceAgentFactory.get(CampaignServiceAgent).moreBanners(this.userSession.selectedCopyItem.Id)]:[2];case 1:return t=r.sent(),i=this.userSession.advertisementType==AdvertisementType.SOCIALFB?BannerSize.Format1200x628:this.userSession.advertisementType==AdvertisementType.FLYER?BannerSize.Format320x480:BannerSize.Format300x250,n=t.BannerIds.map(function(e,t){return{Id:e,Uri:s.selectedPdv.getBannerUri(i,e)}}),this.renderTemplateScript("modal-change-graphics-template-alt1",n[1]),this.renderTemplateScript("modal-change-graphics-template-current",n[0]),this.renderTemplateScript("modal-change-graphics-template-alt2",n[2]),[2]}})})})}),this.renderTemplateScript("customUI-template"),this.setClickToMap(),this.setClickToCall()},t.prototype.updateNextButton=function(){this.html.find("#submitter").prop("disabled",this.switch())},t.prototype.switch=function(){switch(this.userSession.objective){case EvaluationObjective.Branding:return!1;case EvaluationObjective.NewOffer:return""===this.customProductDescription.val()||"[il tuo prodotto qui]"===this.customProductDescription.val()||void 0===this.customProductDescription.val();case EvaluationObjective.PromotionDiscount:return""===this.customProductDescription.val()||"[il tuo prodotto qui]"===this.customProductDescription.val()||void 0===this.customProductDescription.val()||""===this.customDiscount.val()||"[XX]"===this.customDiscount.val()||void 0===this.customDiscount.val();case EvaluationObjective.PromotionPrice:return""===this.customProductDescription.val()||"[il tuo prodotto qui]"===this.customProductDescription.val()||void 0===this.customProductDescription.val()||""===this.customPrice.val()||"[XX]"===this.customPrice.val()||void 0===this.customPrice.val();default:return!1}},t.prototype.onNavigatedTo=function(){this.sidebar.changeMode(SidebarMode.Unavailable),this.selectedPdv=this.userSession.pdvs[0],this.customBusinessName.val(this.userSession.businessName!==this.userSession.originalBusinessName?this.userSession.businessName:this.userSession.originalBusinessName),this.customProductDescription.val(this.userSession.productDescription),this.customDiscount.val(this.userSession.discount),this.customPrice.val(this.userSession.discount),this.updateNextButton()},t.prototype.goToRiepilogo=function(e){e.preventDefault(),this.setCustomValues(),this.setClickToCall(),this.setClickToMap(),this.updateBanners(),this.navigo.navigate("riepilogo-campagna")},Object.defineProperty(t.prototype,"customBusinessName",{get:function(){return this.html.find("#customBusinessName")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"customProductDescription",{get:function(){return this.html.find("#customProductDescription")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"customDiscount",{get:function(){return this.html.find("#customDiscount")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"customPrice",{get:function(){return this.html.find("#customPrice")},enumerable:!0,configurable:!0}),t.prototype.setCustomValues=function(){this.userSession.businessName=this.customBusinessName.val(),this.userSession.discount=this.userSession.objective===EvaluationObjective.PromotionPrice?this.customPrice.val():this.customDiscount.val(),this.userSession.productDescription=this.customProductDescription.val(),this.updateNextButton()},t.prototype.contactsCarouselChanged=function(e){this.selectedPdv=this.userSession.pdvs[e],this.updateBanners(),this.html.find(".number").text(this.selectedPdv.number)},t.prototype.updateBanners=function(){var e=this;this.html.find("[data-banner-size]").each(function(t,i){var n=$(i),s=BannerSize[n.data("banner-size")],r=e.selectedPdv.getBannerUri(s);n.is("img")?n.attr("src",r):n.attr("href",r)});var t=this.userSession.selectedCopyItem?this.userSession.selectedCopyItem.SuggestedTitle:"",i=this.userSession.selectedCopyItem?this.userSession.selectedCopyItem.SuggestedDescription:"",n=this.userSession.selectedCopyItem&&this.userSession.businessName+" | "+this.userSession.selectedCopyItem.SuggestedHeadline||"",s=this.userSession.selectedCopyItem&&this.userSession.selectedCopyItem.SuggestedRow1||"",r=this.userSession.searchRow2Description,o=landingUrlAdmove+this.userSession.pdvs[0].seo.replace(/\d/,"XX");this.html.find("#slider-preview .title").textAndTitle(t),this.html.find("#slider-preview .description").textAndTitle(i),this.html.find("#slider-preview .headline").textAndTitle(n),this.html.find("#slider-preview .row1").textAndTitle(s),this.html.find("#slider-preview .row2").textAndTitle(r),this.html.find("#slider-preview .website").textAndTitle(o)},t}(campagnaBase),riepilogocampagna=function(e){function t(){return e.call(this,"riepilogo-campagna.html")||this}return __extends(t,e),t.prototype.onLoad=function(){this.renderTemplateScript("riepilogo-template"),this.renderTemplateScript("riepilogo-template-2"),this.renderTemplateScript("riepilogo-invoice-template"),e.prototype.onLoad.call(this),this.html.find("#invoice-form").validator(),this.html.find("[data-page-ordine]").click(this.processPayment.bind(this)),this.html.find("[data-page-ordine-panel]").toggle(!this.needInvoiceData),this.html.find(".approvingly").toggle(this.userSession.manualData.isSet),this.html.find("#invoice-form").submit(this.processPayment.bind(this)),$("html, body, #page").trigger("click")},t.prototype.onNavigatedTo=function(){e.prototype.onNavigatedTo.call(this),this.sidebar.changeMode(SidebarMode.ReadOnly)},Object.defineProperty(t.prototype,"formattedTotalVatPrice",{get:function(){return this.userSession.totalVatPrice.toPriceFormat()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"formattedTotalPrice",{get:function(){return this.userSession.tailored?(this.userSession.totalPrice-50).toPriceFormat():this.userSession.formattedTotalPrice},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"formattedVat",{get:function(){return(this.userSession.totalVatPrice-this.userSession.totalPrice).toPriceFormat()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"needInvoiceData",{get:function(){return this.userSession.agencyInfo.onlinePayment},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isSearchType",{get:function(){return this.userSession.advertisementType===AdvertisementType.SEARCHGOOGLE},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keywords",{get:function(){var e=[];if(this.userSession.manualData.isSet)e=this.userSession.manualData.keywords;else{var t=this.userSession.selectedCopyItem;t.SuggestedKeywords&&(e=t.SuggestedKeywords)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"formattedStartDate",{get:function(){return moment(this.userSession.campaignStartDate).userLocale().format("ddd, D MMMM YYYY")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"formattedEndDate",{get:function(){var e=moment(this.userSession.campaignStartDate).add(moment.duration(this.userSession.pdvs.Select(function(e){return e.selectedProduct&&e.selectedProduct.item.EstimatedDuration}).Max()));return moment(e).userLocale().format("ddd, D MMMM YYYY")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalReach",{get:function(){return this.userSession.pdvs.Sum(function(e){return e.selectedProduct?e.selectedProduct.item.Value:0}).toLocaleString()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texts",{get:function(){if(this.userSession.advertisementType===AdvertisementType.SEARCHGOOGLE){if(this.userSession.manualData.isSet)return[this.userSession.manualData.headline,this.userSession.manualData.row1,this.userSession.manualData.row2];if(this.userSession.selectedCopyItem){var e=this.userSession.selectedCopyItem;return[this.userSession.businessName+" - "+e.SuggestedHeadline,landingUrlAdmove+this.userSession.pdvs[0].seo.replace(/\d/,"XX"),e.SuggestedRow1,this.userSession.searchRow2Description]}}return[]},enumerable:!0,configurable:!0}),t.prototype.processPayment=function(e){var t=this;e.preventDefault(),0===this.html.find("#invoice-form").has(".has-error").length&&this.runAsync(function(){return __awaiter(t,void 0,void 0,function(){var e,t,i,n,s=this;return __generator(this,function(r){switch(r.label){case 0:return e=ServiceAgentFactory.get(CampaignServiceAgent),[4,e.prepareCampaignGroupDraft({Campaigns:this.userSession.pdvs.map(function(e){return s.getPdvDraft(e)})})];case 1:return t=r.sent(),this.userSession.agencyInfo.onlinePayment?(i=ServiceAgentFactory.get(InvoiceServiceAgent),[4,i.prepareForCampaignGroup(t.CampaignGroupId,{Address:this.html.find("[name=address]").val(),City:this.html.find("[name=citta]").val(),CompanyName:this.html.find("[name=ragioneSociale]").val(),InvoiceEmail:this.html.find("[name=email]").val(),InvoiceVatCode:this.html.find("[name=piva]").val(),PhoneNumber:this.userSession.agencyInfo.agency.AgencyReferralPhoneNumber,PostalCode:this.html.find("[name=cap]").val(),CountryId:3574,CouponCode:"",State:"Italy",SDICode:this.html.find("[name=SDICode]").val(),InvoicePECMail:this.html.find("[name=PECMail]").val()})]):[3,3];case 2:r.sent(),r.label=3;case 3:return $.cookie&&$.cookie("lastCampaignGroup",JSON.stringify({customName:this.userSession.getCustomName,campaignGroupId:t.CampaignGroupId})),[4,e.handleCampaignPayment(t.CampaignGroupId)];case 4:return n=r.sent(),n.RedirectUri?document.location.href=n.RedirectUri:this.navigo.navigate("pagamento-completato"),[2]}})})})},t.prototype.getPdvDraft=function(e){return{ProposalItemId:e.proposal.Id,ProposalCopyItemId:this.userSession.selectedCopyItem?this.userSession.selectedCopyItem.Id:void 0,ProposalProductItemId:e.selectedProduct?e.selectedProduct.item.Id:void 0,BannerCode:e.session.selectedBannerId,ProductDescription:this.userSession.productDescription,Discount:this.userSession.discount,SearchText:this.userSession.searchText,BusinessName:this.userSession.businessName,Address:void 0==e.clickToMap||null==e.clickToMap?e.address:e.clickToMap,MobilePhone:e.phoneNumber,BusinessCategoryId:this.userSession.businessCategoryId,StartDate:this.userSession.campaignStartDate,Budget:e.selectedProduct.item.Price,Locations:[{Latitude:e.location.lat,Longitude:e.location.lng}],Objective:this.userSession.objective,Website:e.detail.Website,FacebookPage:e.detail.Url,DisplayUrl:landingUrlAdmove+e.seo,CampaignCustomName:this.userSession.getCustomName.length<100?this.userSession.getCustomName:this.userSession.getCustomName.slice(0,100),Headline:this.userSession.manualData.isSet&&this.userSession.manualData.headline||this.userSession.selectedCopyItem&&this.userSession.selectedCopyItem.SuggestedHeadline||"",Row1:this.userSession.manualData.isSet&&this.userSession.manualData.row1||this.userSession.selectedCopyItem&&this.userSession.selectedCopyItem.SuggestedRow1||"",Row2:this.userSession.manualData.isSet&&this.userSession.manualData.row2||this.userSession.searchRow2Description||"",Title:this.userSession.manualData.isSet&&this.userSession.manualData.title||(this.userSession.selectedCopyItem?this.userSession.selectedCopyItem.SuggestedTitle:""),Description:this.userSession.manualData.isSet&&this.userSession.manualData.description||(this.userSession.selectedCopyItem?this.userSession.selectedCopyItem.SuggestedDescription:""),CustomKeywords:this.userSession.manualData.isSet&&this.userSession.manualData.keywords||[],ButtonLink:e.uriClickToMap,CtcLink:e.clickToCall,CustomBanners:e.getCustomBannerUris(),TailoredBanners:this.userSession.getTailoredCustomContentsUris(),IsBulk:!1,Cluster:e.detail.Cluster,Radius:e.detail.Radius}},t.prototype.selectPickerChanged=function(e){this.selectedPdv=this.userSession.pdvs[e],this.renderTemplateScript("dettaglioRiepilogo-template",{Pdv:this.selectedPdv,isNotTailored:!this.userSession.tailored}),this.html.find(".number").text(this.selectedPdv.number),this.updateBanners()},t.prototype.updateBanners=function(){var e=this;this.html.find("[data-banner-size]").each(function(t,i){var n=$(i),s=BannerSize[n.data("banner-size")],r=e.selectedPdv.getBannerUri(s);n.attr("src",r)});var t=this.getPdvDraft(this.selectedPdv),i=landingUrlAdmove+this.userSession.pdvs[0].seo.replace(/\d/,"XX");this.html.find("#slider-preview .title").textAndTitle(t.Title),this.html.find("#slider-preview .description").textAndTitle(t.Description);var n=t.BusinessName+" | "+t.Headline;this.html.find("#slider-preview .headline").textAndTitle(n),this.html.find("#slider-preview .row1").textAndTitle(t.Row1),this.html.find("#slider-preview .row2").textAndTitle(t.Row2),this.html.find("#slider-preview .website").textAndTitle(i)},t}(campagnaBase),pagamentocompletato=function(e){function t(){return e.call(this,"pagamento-completato.html")||this}return __extends(t,e),t.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this);var i=$("[name=campaign_name]"),n=void 0;if($.cookie){var s=$.cookie("lastCampaignGroup");s&&(n=JSON.parse(s),i.val(n.customName))}this.html.find("form").submit(function(e){return __awaiter(t,void 0,void 0,function(){var t=this;return __generator(this,function(s){switch(s.label){case 0:return e.preventDefault(),n?[4,this.runAsync(function(){return __awaiter(t,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=ServiceAgentFactory.get(CampaignServiceAgent),[4,e.renameCampaign(n.campaignGroupId,i.val())];case 1:return t.sent(),[2]}})})})]:[3,2];case 1:s.sent(),s.label=2;case 2:return this.navigo.navigate("dashboard"),[2]}})})})},t.prototype.onNavigatedTo=function(){e.prototype.onNavigatedTo.call(this),this.sidebar.changeMode(SidebarMode.Unavailable)},t}(Page),personalizzacampagnacreativita=function(e){function t(){return e.call(this,"personalizza-campagna-creativita.html")||this}return __extends(t,e),t.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this),this.userSession.manualData.isSet=!0,this.selectedPdv=this.userSession.pdvs[0];var i=this.getVisibleBannerIndexes();this.html.find("[data-file]").each(function(e,t){var n=$(t);i.Contains(parseInt(n.data("file")))||n.remove()}),this.html.find("#add-graphic").on("cssClassChanged",function(){t.updateBanners()}),this.userSession.advertisementType===AdvertisementType.SOCIALFB?this.html.find("p.hide.facebook").removeClass("hide"):this.userSession.advertisementType===AdvertisementType.SEARCHGOOGLE?this.html.find("p.hide.google").removeClass("hide"):this.html.find("p.hide.app").removeClass("hide"),this.html.find("[data-main-title],[data-main-description],[data-main-headline],[data-main-row1],[data-main-row2]").keyup(this.updateBanners.bind(this)),this.renderTemplateScript("customUI-template"),this.setClickToMap(),this.setClickToCall()},t.prototype.onNavigatedTo=function(){this.sidebar.changeMode(SidebarMode.Unavailable),this.selectedPdv=this.userSession.pdvs[0],this.setClickToMap(),this.setClickToCall(),this.updateBanners()},t.prototype.goToRiepilogo=function(e){e.preventDefault(),this.setClickToMap(),this.setClickToCall(),this.updateBanners(),this.navigo.navigate("riepilogo-campagna")},t.prototype.dropzoneComplete=function(e,t,i){var n;n="undefined"!=typeof i?this.userSession.pdvs[i].manualData.customBanners:this.userSession.manualData.customBanners,200===e.status?n.set(t,JSON.parse(e.responseText).TempUri):n.delete(t),this.updateBanners()},t.prototype.dropzoneRemove=function(e,t){var i;i="undefined"!=typeof t?this.userSession.pdvs[t].manualData.customBanners:this.userSession.manualData.customBanners,i.delete(e),this.updateBanners()},t.prototype.contactsCarouselChanged=function(e){this.selectedPdv=this.userSession.pdvs[e],this.updateBanners(),this.html.find(".number").text(this.selectedPdv.number)},t.prototype.updateBanners=function(){var e=this;this.html.find("[data-banner-size]").each(function(t,i){var n=$(i),s=BannerSize[n.data("banner-size")],r=e.selectedPdv.getBannerUri(s);n.is("img")?n.attr("src",r):n.attr("href",r)});var t=this.html.find("[data-main-title]").val(),i=this.html.find("[data-main-description]").val(),n=this.userSession.businessName+" - "+this.html.find("[data-main-headline]").val(),s=this.html.find("[data-main-row1]").val(),r=this.html.find("[data-main-row2]").val(),o=landingUrlAdmove+this.userSession.pdvs[0].seo.replace(/\d/,"XX");this.userSession.manualData.description=i,this.userSession.manualData.title=t,this.html.find("#slider-preview .title").textAndTitle(t),this.html.find("#slider-preview .description").textAndTitle(i),this.html.find("#slider-preview .headline").textAndTitle(n),this.html.find("#slider-preview .row1").textAndTitle(s),this.html.find("#slider-preview .row2").textAndTitle(r),this.html.find("#slider-preview .website").textAndTitle(o)},t}(campagnaBase),account=function(e){function t(){return e.call(this,"account.html")||this}return __extends(t,e),t.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this),this.loadData(),this.html.find("[data-page-edit]").click(function(e){t.agencyEdit(e,!0)}),this.html.find("[data-page-edit-cancel]").click(function(e){t.agencyEdit(e,!1)}),this.html.find("[data-page-edit-save]").click(function(e){t.runAsync(function(){return __awaiter(t,void 0,void 0,function(){var t,i;return __generator(this,function(n){switch(n.label){case 0:return t=ServiceAgentFactory.get(AgencyServiceAgent),i=this.html.find("[name=description]").eq(0).val(),i===this.account.AgencyDescription&&(i=this.html.find("[name=description]").eq(1).val()),this.account.AgencyDescription=i,this.account.AgencyReferralFirstName=this.html.find("[name=firstName]").val(),this.account.AgencyReferralLastName=this.html.find("[name=lastName]").val(),this.account.AgencyReferralEmail=this.html.find("[name=email]").val(),this.account.AgencyReferralPhoneNumber=this.html.find("[name=phoneNumber]").val(),this.account.AgencyAddress=this.html.find("[name=address]").val(),this.account.AgencyPostalCode=this.html.find("[name=postalCode]").val(),this.account.AgencyCity=this.html.find("[name=city]").val(),[4,t.updateAgency(this.account)];case 1:return n.sent(),this.agencyEdit(e,!1),this.renderTemplateScript("account-template"),this.renderTemplateScript("invoice-data-template"),[2]}})})})}),this.html.find("[data-action-account]").click(function(e){t.changeMenuActive(e),t.showDiv("data-page-div-account")}),this.html.find("[data-action-invoice]").click(function(e){t.changeMenuActive(e),t.showDiv("data-page-div-invoice")}),this.html.find("[data-action-credit]").click(function(e){t.changeMenuActive(e),t.showDiv("data-page-div-credit")}),this.html.find("[data-action-history]").click(function(e){t.changeMenuActive(e),t.showDiv("data-page-div-history")}),this.html.find("[data-action-historytransactions]").click(function(e){t.changeMenuActive(e),t.showDiv("data-page-div-historytransactions")}),this.html.find("[data-action-request-credits]").click(function(e){$("#credit").modal("show")}),this.html.find("[data-page-size]").click(function(e){console.log($(e.target).val())}),this.html.on("change","#pageSizeHistory",function(e){e.preventDefault(),t.loadHistory()}),this.html.on("click","[data-page-previous-history]",function(e){e.preventDefault(),t.currentPage>0&&(t.currentPage--,t.loadHistory())}),this.html.on("click","[data-page-next-history]",function(e){e.preventDefault(),t.currentPage<t.availablePages-1&&(t.currentPage++,t.loadHistory())}),this.html.on("click","[data-page-history]",function(e){e.preventDefault(),t.currentPage=parseInt($(e.target).data("page-history"))-1,t.loadHistory()}),this.html.on("change","#pageSizeTransaction",function(e){e.preventDefault(),t.loadTransaction()}),this.html.on("click","[data-page-previous-transaction]",function(e){e.preventDefault(),t.currentPageTransaction>0&&(t.currentPageTransaction--,t.loadTransaction())}),this.html.on("click","[data-page-next-transaction]",function(e){e.preventDefault(),t.currentPageTransaction<t.availablePagesTransaction-1&&(t.currentPageTransaction++,t.loadTransaction())}),this.html.on("click","[data-page-transaction]",function(e){e.preventDefault(),t.currentPageTransaction=parseInt($(e.target).data("page-transaction"))-1,t.loadTransaction()}),this.showDiv("data-page-div-account")},t.prototype.changeMenuActive=function(e){var t=$(e.target).closest("ul[class*=nav]");$(t).find("li[class=active]").removeClass("active"),$(e.target).closest("li[role=presentation]").addClass("active")},t.prototype.showDiv=function(e){$.each($("div[class=container]").find("div[data-page-section]"),function(t,i){$(i).is("["+e+"]")?$(i).show():$(i).hide()})},t.prototype.agencyEdit=function(e,t){e&&e.preventDefault();var i=this.html.find("[data-page-div-buttons]"),n=i.parent().find("table");$.each(n.find("tr"),function(e,i){t?($($(i).find("td")[1]).hide(),$($(i).find("td")[2]).show()):($($(i).find("td")[1]).show(),$($(i).find("td")[2]).hide())}),this.html.find("[data-page-edit]").toggle(!t),this.html.find("[data-page-edit-cancel]").toggle(t),this.html.find("[data-page-edit-save]").toggle(t)},t.prototype.onNavigatedTo=function(){e.prototype.onNavigatedTo.call(this),this.sidebar.changeMode(SidebarMode.Unavailable),this.agencyEdit(void 0,!1)},t.prototype.loadData=function(){var e=this;this.runAsync(function(){return __awaiter(e,void 0,void 0,function(){var e,t,i,n;return __generator(this,function(s){switch(s.label){case 0:return e=ServiceAgentFactory.get(AgencyServiceAgent),t=ServiceAgentFactory.get(CampaignServiceAgent),i=ServiceAgentFactory.get(InvoiceServiceAgent),[4,this.userSession.agencyInfo.load()];case 1:return s.sent(),this.setNavigationLinks(),this.userSession.agencyInfo.canAskCredit||this.html.find("[data-action-credit]").parent("li").remove(),this.account=this.userSession.agencyInfo.agency,[4,this.loadHistory()];case 2:return s.sent(),[4,this.loadTransaction()];case 3:return s.sent(),n=this,[4,i.get()];case 4:return n.invoices=s.sent(),this.renderTemplateScript("account-header-template"),this.renderTemplateScript("account-template"),this.renderTemplateScript("invoice-data-template"),this.renderTemplateScript("credit-template"),[2]}})})})},t.prototype.loadHistory=function(){var e=this;this.runAsync(function(){return __awaiter(e,void 0,void 0,function(){var e,t,i,n,s,r=this;return __generator(this,function(o){switch(o.label){case 0:return e=this.html.find("#pageSizeHistory"),t=e.val(),this.campaignsPerPage=parseInt(""!=t&&void 0!=t?t:10),void 0==this.currentPage&&(this.currentPage=0),i=ServiceAgentFactory.get(ReportServiceAgent),n=this,[4,i.groups(CampaignStatusEnum.All,this.campaignsPerPage,this.currentPage*this.campaignsPerPage)];case 1:return n.campaigns=o.sent().OrderByDescending(function(e){return e.StartDate}),this.campaigns.forEach(function(e){return e.formattedAmount=e.Amount&&null!=e.Amount?e.Amount.toPriceFormat():["-","-"]}),s=this,[4,i.groupsCount(CampaignStatusEnum.All)];case 2:return s.totalCampaigns=o.sent(),this.availablePages=Math.ceil(this.totalCampaigns/this.campaignsPerPage),this.pages=Array(this.availablePages).fill(0).map(function(e,t){return{value:t+1,isCurrent:t===r.currentPage}}),this.startIndex=this.currentPage*this.campaignsPerPage+1,this.endIndex=this.startIndex+this.campaignsPerPage-1,this.renderTemplateScript("history-template"),[2]}})})})},t.prototype.loadTransaction=function(){var e=this;this.runAsync(function(){return __awaiter(e,void 0,void 0,function(){var e,t,i,n,s,r=this;return __generator(this,function(o){switch(o.label){case 0:return e=this.html.find("#pageSizeTransaction"),t=e.val(),this.transactionsPerPage=parseInt(""!=t&&void 0!=t?t:10),void 0==this.currentPageTransaction&&(this.currentPageTransaction=0),i=ServiceAgentFactory.get(AgencyServiceAgent),n=this,[4,i.getTransactions(this.transactionsPerPage,this.currentPageTransaction*this.transactionsPerPage)];case 1:return n.transactions=o.sent(),this.transactions.forEach(function(e){return e.formattedAmount=e.AgencyTransactionEuroAmount&&null!=e.AgencyTransactionEuroAmount?e.AgencyTransactionEuroAmount.toPriceFormat():["-","-"]}),this.transactions.forEach(function(e){return e.description=e.AgencyTransactionEuroAmount<0?"Campaign Purchased":"Client Requested Charge"}),s=this,[4,i.getTransactions()];case 2:return s.totalTransactions=o.sent().length,this.availablePagesTransaction=Math.ceil(this.totalTransactions/this.transactionsPerPage),this.pagesTransaction=Array(this.availablePagesTransaction).fill(0).map(function(e,t){return{value:t+1,isCurrent:t===r.currentPageTransaction}}),this.startIndexTransaction=this.currentPageTransaction*this.transactionsPerPage+1,this.endIndexTransaction=this.startIndexTransaction+this.transactionsPerPage-1,this.renderTemplateScript("transaction-template"),[2]}})})})},t}(Page),sceltaflusso=function(e){function t(){return e.call(this,"scelta-flusso.html")||this}return __extends(t,e),t.prototype.onNavigatedTo=function(){e.prototype.onNavigatedTo.call(this),this.sidebar.changeMode(SidebarMode.Unavailable)},t.prototype.onLoad=function(){var t=this;e.prototype.onLoad.call(this),this.html.find(".content-flusso").hide(),this.runAsync(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.userSession.agencyInfo.load()];case 1:return e.sent(),this.setNavigationLinks(),this.html.find("[data-agency]").text(this.userSession.agencyInfo.agency.AgencyDescription),1==this.userSession.agencyInfo.onlinePayment&&this.html.find(".flusso.col-lg-3").removeClass("col-lg-3").addClass("col-lg-4").filter(".bulk").remove(),this.html.find(".content-flusso").fadeIn(100),[2]}})})})},t}(Page),homeflusso3=function(e){function t(){return e.call(this,"home-flusso-3.html")||this}return __extends(t,e),t.prototype.onNavigatedTo=function(){e.prototype.onNavigatedTo.call(this),this.sidebar.changeMode(SidebarMode.Unavailable),this.userSession.clear()},t.prototype.onLoad=function(){e.prototype.onLoad.call(this),this.html.find("#main").submit(this.formSubmit.bind(this)),this.html.find("#popup3-multi form").submit(this.popupSubmit.bind(this))},t.prototype.popupSubmit=function(e){
var t=this;e.preventDefault(),this.html.find("#popup3-multi").modal("hide");var i=this.html.find(".slogan.selected").data("item");this.runAsync(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.userSession.addPdv(i)];case 1:return e.sent(),this.navigo.navigate("mappa-flusso-3"),[2]}})})})},t.prototype.formSubmit=function(e){var t=this;e.isDefaultPrevented()||(e.preventDefault(),this.userSession.clear(),this.userSession.businessName=this.userSession.searchText=this.html.find("[name=businessName]").val(),this.userSession.flow3.address=this.html.find("[name=address]").val(),this.userSession.flow3.radius=parseInt("1000"),this.runAsync(function(){return __awaiter(t,void 0,void 0,function(){var e,t,i;return __generator(this,function(n){switch(n.label){case 0:return e=ServiceAgentFactory.get(SemanticWebServiceAgent),[4,e.searchLocation(this.userSession.flow3.address||"",this.userSession.businessName)];case 1:return t=n.sent(),0==t.Results.length?[3,6]:t.Results.length>1?(this.renderTemplateScript("slogan-list-template",t.Results),this.html.find(".slogan").each(function(e,i){$(i).data("item",t.Results[e])}),this.html.find(".slogan").first().trigger("click"),this.html.find("#popup3-multi").modal("show"),[3,5]):[3,2];case 2:return[4,this.userSession.addPdv(t.Results[0])];case 3:return n.sent(),i=this.userSession,[4,this.userSession.InsightRadiusAsync(t.Results[0].Geometry.location)];case 4:i.insightRadiusValues=n.sent(),this.navigo.navigate("mappa-flusso-3"),n.label=5;case 5:return[3,7];case 6:this.showAlert("Non trovato","Nessuna insegna trovata"),n.label=7;case 7:return[2]}})})}))},t}(Page),sceltaprodotto=function(e){function t(){return e.call(this,"scelta-prodotto.html")||this}return __extends(t,e),t.prototype.onLoad=function(){e.prototype.onLoad.call(this)},t.prototype.updateHeading=function(e){var t="<strong>Per le attività</strong> che vogliono ";switch(this.userSession.objectiveDescription){case"PROMO":t+="mettere in evidenza le loro promozioni";break;case"PUSH":t+="proporre uno specifico prodotto o servizio";break;case"DISCOUNT":t+="dare rilievo ai propri sconti";break;default:t+="aumentare la loro visibilità"}t+=" e battere la concorrenza, il prodotto migliore è: ",this.html.find("[data-best_text]").empty().html(t),this.html.find("[data-best_product]").text(e)},t.prototype.selectBestProposal=function(){return __awaiter(this,void 0,void 0,function(){var e,t=this;return __generator(this,function(i){switch(i.label){case 0:return e=this,[4,this.runAsync(function(){return __awaiter(t,void 0,void 0,function(){var t,i,n,s=this;return __generator(this,function(r){switch(r.label){case 0:return[4,this.userSession.pdvs[0].evaluate()];case 1:return t=r.sent(),this.userSession.pdvs[0].evaluation=t,i=t.Proposals.OrderByDescending(function(e){return e.ProposalInfo.Efficacy}).First(),n=i.ProposalInfo.Efficacy,this.html.find("[data-value]").each(function(e,r){var o=$(r),a=o.parents("[data-type]:first").data("type"),c=t.Proposals.find(function(e){return e.AdvertisementType==a});if(c){var u=r.attributes.getNamedItem("data-value");u.value=(c.ProposalInfo.Efficacy/n*100).toString(),o.data("value",u.value).attr("data-value",u.value)}else o.parents(".cont:first").remove();i==c&&(s.bestProposalDiv=o.parents(".cont:first").find(".proposal"))}),e.html.find(".parent-target").trigger("sorting"),[2]}})})})];case 1:return i.sent(),[2]}})})},t.prototype.onNavigatedFrom=function(){e.prototype.onNavigatedFrom.call(this),this.userSession.advertisementType=AdvertisementType[$(".proposal-selected [data-type]").data("type")],this.userSession.advertisementTypeDescription=$(".proposal-selected .panel-heading").text()},t.prototype.onNavigatedTo=function(){e.prototype.onNavigatedTo.call(this),this.sidebar.changeMode(SidebarMode.Unavailable)},t}(Page),mappaflusso3=function(e){function t(){return e.call(this,"mappa-flusso-3.html")||this}return __extends(t,e),t.prototype.onNavigatedTo=function(){e.prototype.onNavigatedTo.call(this),this.sidebar.changeMode(SidebarMode.Unavailable)},t.prototype.onLoad=function(){e.prototype.onLoad.call(this),this.renderTemplateScript("business-template",{businessName:this.userSession.businessName,address:this.userSession.pdvs[0].address,phoneNumber:this.userSession.pdvs[0].phoneNumber,image:"No cat"===this.userSession.pdvs[0].detail.Categories[0].Category?"/assets/img/logo.png":this.userSession.pdvs[0].mapItem.image})},t.prototype.updatePdi=function(e){var t=this,i=this.userSession.getPdvById(e);i&&this.runAsync(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,i.load()];case 1:return e.sent(),this.onUpdatePdv&&this.onUpdatePdv(i.mapItem),[2]}})})})},t.prototype.pdiMoved=function(e,t){return __awaiter(this,void 0,void 0,function(){var i,n,s,r;return __generator(this,function(o){switch(o.label){case 0:if(i=this.userSession.getPdvById(e),!i)return[3,4];i.location=t,i.locationAddress="-",o.label=1;case 1:return o.trys.push([1,3,,4]),n=new GoogleServiceAgent,s=i,[4,n.geocode(t)];case 2:return s.locationAddress=o.sent().formatted_address,[3,4];case 3:return r=o.sent(),console.error(r),[3,4];case 4:return[2]}})})},t.prototype.pdiReset=function(e){var t=this,i=this.userSession.getPdvById(e);i&&(i.reset(),this.runAsync(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,i.load()];case 1:return e.sent(),this.onUpdatePdv&&this.onUpdatePdv(i.mapItem),[2]}})})}))},t.prototype.readinsightRadiusValues=function(e){var t=this.userSession.getinsightRadiusValues,i=void 0;if(t)for(var n=0;n<t.Insights.length;n++)if(t.Insights[n].Radius===e){i=t.Insights[n];break}return i},t}(Page),campagnacreativitaadhoc=function(e){function t(){return e.call(this,"campagna-creativita-ad-hoc.html")||this}return __extends(t,e),t.prototype.onLoad=function(){e.prototype.onLoad.call(this)},t.prototype.onNavigatedTo=function(){this.sidebar.changeMode(SidebarMode.ReadOnly)},t.prototype.dropzoneComplete=function(e,t){200===e.status?this.userSession.tailoredCustomContents.set(t,JSON.parse(e.responseText).Uri):this.userSession.tailoredCustomContents.delete(t)},t.prototype.dropzoneRemove=function(e,t){this.userSession.tailoredCustomContents.delete(t)},t.prototype.goToRiepilogo=function(e){e.preventDefault(),this.userSession.productDescription=this.html.find("textarea").val(),this.userSession.tailored=!0,this.navigo.navigate("riepilogo-campagna")},t}(campagnaBase),errore=function(e){function t(){return e.call(this,"errore.html")||this}return __extends(t,e),t.prototype.onNavigatedTo=function(){e.prototype.onNavigatedTo.call(this),this.sidebar.changeMode(SidebarMode.Unavailable)},t.prototype.onLoad=function(){e.prototype.onLoad.call(this);var t=document.location.href.parseQuery();this.html.find("[data-title]").text(t.title||"Errore"),this.html.find("[data-description]").text(t.description||"Si è verificato un errore imprevisto")},t}(Page),bulkcopertura=function(e){function t(){var t=this;return Handlebars.registerHelper("tooltip",function(e){var t="densità ";t+=e<=4?"minima":e>4&&e<=9?"moderata":e>8&&e<=12?"considerevole":"massima";for(var i="<div class='text-left'><div class='mt-5 mb-5 fs-12 text-left'><b class='fs-15'>Density index: </b>"+t+"</div><div class='di screw-content d"+e+"'>",n=1;n<=17;n++){var s=n<=e?"active":"";i+="<div class='"+s+" part screw'></div>"}return i+"</div><div class='di-number' style='margin-left:calc(100%/16*"+(e-1)+")'>"+e+"</div></div>"}),t=e.call(this,"bulk-copertura.html")||this}return __extends(t,e),t.prototype.onLoad=function(){e.prototype.onLoad.call(this),this.renderTemplateScript("grid-pdv",{Pdvs:this.userSession.pdvs,TargetName:this.userSession.pdvs[0].reachWording}),this.renderTemplateScript("plan-bulk",{TargetName:this.userSession.pdvs[0].reachWording,Target:this.userSession.pdvs.Sum(function(e){return e.selectedProduct.item.Value}).toLocaleString(),Budget:(+this.userSession.pdvs.Sum(function(e){return e.products[0].item.Price})).toPriceFormat(),MobUsers:this.userSession.pdvs.Sum(function(e){return e.detail.PotentialUsers}).toLocaleString(),MalePercentage:Math.round(100*this.userSession.pdvs.Average(function(e){return e.detail.MaleStatsPercentage}))+"%",FemalePercentage:Math.round(100*this.userSession.pdvs.Average(function(e){return e.detail.FemaleStatsPercentage}))+"%"}),this.renderTemplateScript("sidebar-bulk",{BusinessName:this.userSession.businessName,CountPdv:this.userSession.pdvs.length,CountCde:this.userSession.pdvs.length,ProductDesc:this.userSession.advertisementTypeDescription,MaxBudget:(+this.userSession.bulkData.budget).toPriceFormat(),StartDate:this.userSession.campaignStartDate.toLocaleDateString(),EndDate:this.userSession.bulkData.EndDate.toLocaleDateString(),Budget:(+this.userSession.pdvs.Sum(function(e){return e.products[0].item.Price})).toPriceFormat(),CountCity:this.userSession.pdvs.GroupBy(function(e){return e.geocodeAddressCDE.City}).Count(),CountProvince:this.userSession.pdvs.GroupBy(function(e){return e.geocodeAddressCDE.Province}).Count(),CountRegion:this.userSession.pdvs.GroupBy(function(e){return e.geocodeAddressCDE.Region}).Count(),TargetName:this.userSession.pdvs[0].reachWording,Target:this.userSession.pdvs.Sum(function(e){return e.selectedProduct.item.Value}).toLocaleString(),MobUsers:this.userSession.pdvs.Sum(function(e){return e.detail.PotentialUsers}).toLocaleString(),MalePercentage:Math.round(100*this.userSession.pdvs.Average(function(e){return e.detail.MaleStatsPercentage}))+"%",FemalePercentage:Math.round(100*this.userSession.pdvs.Average(function(e){return e.detail.FemaleStatsPercentage}))+"%"})},t.prototype.preparePlugin=function(e){var t=this;this._plugin=e,this._plugin.removeAll(),this.runAsync(function(){return __awaiter(t,void 0,void 0,function(){var e,t,i;return __generator(this,function(n){for(e=0,t=this.userSession.pdvs;e<t.length;e++)i=t[e],this._plugin.actions("add",!1,i.mapItem);return[2]})})}),this._plugin.actions("added-all",!1)},t.prototype.getFlow=function(){return this.userSession.bulkData.flow.toString()},t.prototype.getOrderBy=function(){return this.userSession.bulkData.orderBy},t}(Page),bulkcreativita=function(e){function t(){return e.call(this,"bulk-creativita.html")||this}return __extends(t,e),t.prototype.onLoad=function(){e.prototype.onLoad.call(this,!0),this.selectedPdv=this.userSession.pdvs[0];var t=this.getVisibleBannerIndexes(!0);this.html.find("[data-file]").each(function(e,i){var n=$(i);t.Contains(parseInt(n.data("file")))||n.remove()}),this.userSession.manualData.isSet=!0,this.updateBanners()},t.prototype.dropzoneComplete=function(e,t){var i;i=this.userSession.manualData.customBanners,200===e.status?i.set(t,JSON.parse(e.responseText).TempUri):i.delete(t),this.updateBanners()},t.prototype.dropzoneRemove=function(e){var t;t=this.userSession.manualData.customBanners,t.delete(e)},t.prototype.updateBanners=function(){var e=this;this.html.find("[data-banner-size]").each(function(t,i){var n=$(i),s=BannerSize[n.data("banner-size")],r=e.selectedPdv.getBannerUri(s);n.is("img")?n.attr("src",r):n.attr("href",r)})},t}(campagnaBase),bulkpianificazione=function(e){function t(){return e.call(this,"bulk-pianificazione.html")||this}return __extends(t,e),t.prototype.onLoad=function(){e.prototype.onLoad.call(this),this.userSession.clear(),this.html.find("form").submit(this.formUploadFile.bind(this))},t.prototype.gotoConfigurazione=function(){return __awaiter(this,void 0,void 0,function(){var e,t,i,n,s;return __generator(this,function(r){switch(r.label){case 0:return e=ServiceAgentFactory.get(SemanticWebServiceAgent),[4,e.getBulkDetails(this.userSession.businessName,this.userSession.bulkData.proposalBulkId)];case 1:t=r.sent(),i=0,r.label=2;case 2:return i<this.bulkData.length?(n=this.bulkData[i],s=t[i],[4,this.userSession.addBulkPdv(n.Label,n.AddressPDV,n.AddressCDE,n.LandingUrl,n.TrackingPixel,n.Level,n.GoogleId,s)]):[3,5];case 3:r.sent(),r.label=4;case 4:return i++,[3,2];case 5:return this.navigo.navigate("bulk-configurazione"),[2]}})})},t.prototype.formUploadFile=function(e){var t=this;e.preventDefault(),this.runAsync(function(){return __awaiter(t,void 0,void 0,function(){var t,i,n=this;return __generator(this,function(s){switch(s.label){case 0:return this.bulkData=[],this.bulkDataError=[],t=new FormData(this.html.find("form")[0]),this.semanticServiceAgent=ServiceAgentFactory.get(SemanticWebServiceAgent),[4,this.semanticServiceAgent.GeocodeLocationFile(t)];case 1:return i=s.sent(),this.userSession.bulkData.proposalBulkId=i.ProposalBulkId,this.userSession.bulkData.Landings=i.Results.Select(function(e){return e.LandingUrl}).Distinct(),""==this.userSession.bulkData.Landings.First()&&(this.userSession.bulkData.Landings=[]),this.userSession.businessName=$(e.target).find("[name=businessName]").val(),this.userSession.businessCategoryId="No cat",i.Results.forEach(function(e){return e.Status?n.bulkData.push(e):n.bulkDataError.push(e)}),0!=this.bulkDataError.length?[3,3]:(this.html.closest("body").trigger("preloader",[this.bulkData.length]),[4,this.gotoConfigurazione()]);case 2:return s.sent(),[3,4];case 3:this.renderTemplateScript("error-list-template",this.bulkDataError),this.html.find("[data-pdv-error]").text(this.bulkDataError.length),this.html.find("[data-pdv-total]").text(this.bulkData.length+this.bulkDataError.length),this.html.find("#popup-error").modal("show"),s.label=4;case 4:return[2]}})})},RunPolicy.Try,!0,!0)},t.prototype.updateAll=function(e,t){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(n){return e.preventDefault(),this.runAsync(function(){return __awaiter(i,void 0,void 0,function(){var i,n,s,r,o,a,c;return __generator(this,function(u){switch(u.label){case 0:i=0,n=t,u.label=1;case 1:return i<n.length?(s=n[i],r=s.children[0].attributes[1].nodeValue,o=this.bulkDataError.FirstOrDefault(function(e){return e.GoogleId==r}),(a=s.children[1].value)?(this.semanticServiceAgent=ServiceAgentFactory.get(SemanticWebServiceAgent),[4,this.semanticServiceAgent.Geocode(this.userSession.bulkData.proposalBulkId,r,a)]):[3,3]):[3,4];case 2:c=u.sent(),null!=c&&(this.bulkData.Any(function(e){return e.GoogleId==c.PlaceId})||(o.GoogleId=c.PlaceId),o.AddressCDE=c,o.Status=!0,this.bulkDataError.Remove(o),this.bulkData.push(o),this.html.find(e.target.parentElement.parentElement).addClass("done")),u.label=3;case 3:return i++,[3,1];case 4:return 0!=this.bulkDataError.length?[3,6]:(this.html.find("#popup-error").modal("hide"),this.html.closest("body").trigger("preloader",[this.bulkData.length]),[4,this.gotoConfigurazione()]);case 5:return u.sent(),[3,7];case 6:this.renderTemplateScript("error-list-template",this.bulkDataError),this.html.find("[data-pdv-error]").text(this.bulkDataError.length),this.html.find("[data-pdv-total]").text(this.bulkData.length+this.bulkDataError.length),u.label=7;case 7:return[2]}})})},RunPolicy.Try,!0,!0),[2]})})},t.prototype.updateRow=function(e,t,i){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(s){return e.preventDefault(),this.runAsync(function(){return __awaiter(n,void 0,void 0,function(){var n,s;return __generator(this,function(r){switch(r.label){case 0:return n=this.bulkDataError.FirstOrDefault(function(e){return e.GoogleId==t}),i?(this.semanticServiceAgent=ServiceAgentFactory.get(SemanticWebServiceAgent),[4,this.semanticServiceAgent.Geocode(this.userSession.bulkData.proposalBulkId,t,i)]):[3,4];case 1:return s=r.sent(),null==s?[3,4]:(this.bulkData.Any(function(e){return e.GoogleId==s.PlaceId})||(n.GoogleId=s.PlaceId),n.AddressCDE=s,n.Status=!0,this.bulkDataError.Remove(n),this.bulkData.push(n),this.html.find(e.target.parentElement.parentElement).addClass("done"),0!=this.bulkDataError.length?[3,3]:(this.html.find("#popup-error").modal("hide"),this.html.closest("body").trigger("preloader",[this.bulkData.length]),[4,this.gotoConfigurazione()]));case 2:return r.sent(),[3,4];case 3:this.renderTemplateScript("error-list-template",this.bulkDataError),this.html.find("[data-pdv-error]").text(this.bulkDataError.length),this.html.find("[data-pdv-total]").text(this.bulkData.length+this.bulkDataError.length),r.label=4;case 4:return[2]}})})},RunPolicy.Try,!0,!0),[2]})})},t}(Page),bulkriepilogo=function(e){function t(){return e.call(this,"bulk-riepilogo.html")||this}return __extends(t,e),t.prototype.onLoad=function(){e.prototype.onLoad.call(this,!0),this.html.find("[data-page-ordine-panel]").click(this.processPayment.bind(this)),this.renderTemplateScript("riepilogo-bulk",{AgencyName:this.userSession.agencyInfo.agency.AgencyDescription,AgencyPhone:this.userSession.agencyInfo.agency.AgencyReferralPhoneNumber,ReferentName:this.userSession.agencyInfo.agency.AgencyReferralFirstName,ReferentSurame:this.userSession.agencyInfo.agency.AgencyReferralLastName,ReferentEmail:this.userSession.agencyInfo.agency.AgencyReferralEmail,BusinessName:this.userSession.businessName,ProductDesc:this.userSession.advertisementTypeDescription,TargetName:this.userSession.pdvs[0].reachWording,Target:this.userSession.pdvs.Sum(function(e){return e.selectedProduct.item.Value}).toLocaleString(),Budget:this.userSession.bulkData.flow===BulkFlow.High?(+this.userSession.pdvs.Sum(function(e){return e.products[0].item.Price})).toPriceFormat():(+this.userSession.bulkData.budget).toPriceFormat(),StartDate:moment(this.userSession.campaignStartDate).userLocale().format("ddd, D MMMM YYYY"),EndDate:moment(this.userSession.bulkData.EndDate).userLocale().format("ddd, D MMMM YYYY"),TotalPdv:this.userSession.pdvs.length,TotalCde:this.userSession.pdvs.length}),this.renderTemplateScript("riepilogo-bulk-ordine",{formattedTotalVatPrice:this.userSession.totalVatPrice.toPriceFormat(),formattedTotalPrice:this.userSession.formattedTotalPrice,formattedVat:(this.userSession.totalVatPrice-this.userSession.totalPrice).toPriceFormat()}),this.selectedPdv=this.userSession.pdvs[0],this.updateBanners()},t.prototype.getCustomName=function(e){return e.detail.Name+" "+moment(this.userSession.campaignStartDate).format("L")},t.prototype.getPdvDraft=function(e){var t=this.getCustomName(e);return{SearchText:this.userSession.searchText||this.userSession.businessName,ProposalItemId:e.proposal.Id,ProposalCopyItemId:this.userSession.selectedCopyItem?this.userSession.selectedCopyItem.Id:void 0,ProposalProductItemId:e.selectedProduct?e.selectedProduct.item.Id:void 0,BannerCode:e.session.selectedBannerId,ProductDescription:this.userSession.productDescription,Discount:this.userSession.discount,BusinessName:this.userSession.businessName,Address:e.address,MobilePhone:e.phoneNumber,BusinessCategoryId:this.userSession.businessCategoryId,StartDate:this.userSession.campaignStartDate,Budget:e.selectedProduct.item.Price,Locations:[{Latitude:e.location.lat,Longitude:e.location.lng}],Objective:this.userSession.objective,Website:e.detail.Website,FacebookPage:e.detail.Url,DisplayUrl:"",CampaignCustomName:t,Headline:"",Row1:"",Row2:"",Title:"",Description:"",CustomKeywords:[],ButtonLink:e.uriClickToMap,CtcLink:e.clickToCall,CustomBanners:e.getCustomBannerUris(),TailoredBanners:this.userSession.getTailoredCustomContentsUris(),AddressComponent:{Address:e.geocodeAddressCDE.Address,City:e.geocodeAddressCDE.City,Country:e.geocodeAddressCDE.Country,FormattedAddress:e.geocodeAddressCDE.FormattedAddress,Location:e.geocodeAddressCDE.Location,PlaceId:e.geocodeAddressCDE.PlaceId,PostalCode:e.geocodeAddressCDE.PostalCode,Province:e.geocodeAddressCDE.Province,Region:e.geocodeAddressCDE.Region,StreetNumber:e.geocodeAddressCDE.StreetNumber},BulkLandingUrl:e.bulkLandingUrl,BulkTrackingPixel:e.bulkTrackingPixel,IsBulk:!0,Cluster:e.detail.Cluster,Radius:e.detail.Radius,BulkFlow:this.userSession.bulkData.flow,ProposalBulkId:this.userSession.bulkData.proposalBulkId}},t.prototype.processPayment=function(e){var t=this;e.preventDefault(),this.runAsync(function(){return __awaiter(t,void 0,void 0,function(){var e,t,i=this;return __generator(this,function(n){switch(n.label){case 0:return e=ServiceAgentFactory.get(CampaignServiceAgent),[4,e.bulkPrepareCampaign({Campaigns:this.userSession.pdvs.map(function(e){return i.getPdvDraft(e)})})];case 1:return t=n.sent(),$.cookie&&$.cookie("lastCampaignGroup",JSON.stringify({customName:this.userSession.getCustomName,campaignGroupId:t})),this.navigo.navigate("pagamento-completato"),[2]}})})})},t.prototype.updateBanners=function(){var e=this;this.html.find("[data-banner-size]").each(function(t,i){var n=$(i),s=BannerSize[n.data("banner-size")],r=e.selectedPdv.getBannerUri(s);n.attr("src",r)})},t}(campagnaBase),dev={preset:"multi",fakeSemanticWeb:!1,fakeCampaign:!1,fakeGeocodeAddress:!1,fakeInsight:!0},isLocalHost=document.location.href.indexOf("localhost")>0;isLocalHost||(dev.preset="none",dev.fakeSemanticWeb=!1,dev.fakeCampaign=!1,dev.fakeGeocodeAddress=!1,dev.fakeInsight=!0);var clientIds={localhost:{clientId:"711c5e4a-0241-45c7-984a-5d6f1b80fe59",baseUrl:"https://arcadia-api-dev.azurewebsites.net",policy:"B2C_1_GeoSignIn"},"getooltest.azurewebsites.net":{clientId:"711c5e4a-0241-45c7-984a-5d6f1b80fe59",baseUrl:"https://arcadia-api-dev.azurewebsites.net",policy:"B2C_1_GeoSignIn"}},redirect=document.location.protocol+"//"+document.location.host,config=clientIds[document.location.hostname.toLowerCase()],baseUrl,getLoginUrl;config?(baseUrl=config.baseUrl,getLoginUrl=function(e){return void 0===e&&(e=""),"https://login.microsoftonline.com/GeotoolTenant.onmicrosoft.com/oauth2/v2.0/authorize?p="+config.policy+"&client_id="+config.clientId+"&nonce=defaultNonce&redirect_uri="+encodeURIComponent(redirect)+"&scope=openid&response_type=id_token&prompt=login&state="+encodeURIComponent(e)}):console.error("No configuration for "+document.location.host);var landingUrlAdmove=isLocalHost||"admove-agenzie-app-dev.azurewebsites.net"==document.location.hostname.toLowerCase()?"https://ads-dev.admove.com/":"https://ads.admove.com/";ServiceAgentFactory.context=new ServiceAgentContext(baseUrl);var navigationService=new NavigationService("typescript/Navigation/Pages/"),AreaType;!function(e){e[e.Metropolitana=0]="Metropolitana",e[e.Urbana=1]="Urbana",e[e.Cittadina=2]="Cittadina",e[e.Rurale=3]="Rurale"}(AreaType||(AreaType={}));var BulkFlow;!function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.High=2]="High"}(BulkFlow||(BulkFlow={}));